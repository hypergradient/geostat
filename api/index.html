
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../examples/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.34">
    
    
      
        <title>API Reference - Geostat Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.35f28582.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Geostat Documentation" class="md-header__button md-logo" aria-label="Geostat Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Geostat Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Geostat Documentation" class="md-nav__button md-logo" aria-label="Geostat Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Geostat Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.geostat.custom_op" class="md-nav__link">
    <span class="md-ellipsis">
      custom_op
    </span>
  </a>
  
    <nav class="md-nav" aria-label="custom_op">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.custom_op.function" class="md-nav__link">
    <span class="md-ellipsis">
      function
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.geostat.kernel" class="md-nav__link">
    <span class="md-ellipsis">
      kernel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="kernel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.Kernel" class="md-nav__link">
    <span class="md-ellipsis">
      Kernel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Kernel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.Kernel.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.Kernel.call" class="md-nav__link">
    <span class="md-ellipsis">
      call
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.Mix" class="md-nav__link">
    <span class="md-ellipsis">
      Mix
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.Mix.gather_vars" class="md-nav__link">
    <span class="md-ellipsis">
      gather_vars
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.Observation" class="md-nav__link">
    <span class="md-ellipsis">
      Observation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Observation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.Observation.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.block_diag" class="md-nav__link">
    <span class="md-ellipsis">
      block_diag
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.quadstack" class="md-nav__link">
    <span class="md-ellipsis">
      quadstack
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.rampstack" class="md-nav__link">
    <span class="md-ellipsis">
      rampstack
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.smooth_convex" class="md-nav__link">
    <span class="md-ellipsis">
      smooth_convex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.smooth_convex_grad" class="md-nav__link">
    <span class="md-ellipsis">
      smooth_convex_grad
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.geostat.krige" class="md-nav__link">
    <span class="md-ellipsis">
      krige
    </span>
  </a>
  
    <nav class="md-nav" aria-label="krige">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.krige.Krige" class="md-nav__link">
    <span class="md-ellipsis">
      Krige
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Krige">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.krige.Krige.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.krige.Krige.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.krige.cutoff_dist_func" class="md-nav__link">
    <span class="md-ellipsis">
      cutoff_dist_func
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.geostat.mean" class="md-nav__link">
    <span class="md-ellipsis">
      mean
    </span>
  </a>
  
    <nav class="md-nav" aria-label="mean">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.mean.Mean" class="md-nav__link">
    <span class="md-ellipsis">
      Mean
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mean">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.mean.Mean.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.geostat.mesh" class="md-nav__link">
    <span class="md-ellipsis">
      mesh
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.geostat.metric" class="md-nav__link">
    <span class="md-ellipsis">
      metric
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.geostat.model" class="md-nav__link">
    <span class="md-ellipsis">
      model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Featurizer" class="md-nav__link">
    <span class="md-ellipsis">
      Featurizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Featurizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Featurizer--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Featurizer--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Featurizer--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.GP" class="md-nav__link">
    <span class="md-ellipsis">
      GP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.GP--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.GP--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.GP--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model" class="md-nav__link">
    <span class="md-ellipsis">
      Model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.fit--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.fit--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.fit--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.fit--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.generate" class="md-nav__link">
    <span class="md-ellipsis">
      generate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="generate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.generate--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.generate--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.generate--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.generate--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
    <nav class="md-nav" aria-label="predict">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.predict--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.predict--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.predict--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.predict--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.set" class="md-nav__link">
    <span class="md-ellipsis">
      set
    </span>
  </a>
  
    <nav class="md-nav" aria-label="set">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.set--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.set--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.set--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.set--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.set--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.NormalizingFeaturizer" class="md-nav__link">
    <span class="md-ellipsis">
      NormalizingFeaturizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NormalizingFeaturizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.NormalizingFeaturizer--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.NormalizingFeaturizer--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.NormalizingFeaturizer--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Warp" class="md-nav__link">
    <span class="md-ellipsis">
      Warp
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Warp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Warp.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.gp_covariance2" class="md-nav__link">
    <span class="md-ellipsis">
      gp_covariance2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.interpolate_1d_tf" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate_1d_tf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.mvn_log_pdf" class="md-nav__link">
    <span class="md-ellipsis">
      mvn_log_pdf
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.geostat.op" class="md-nav__link">
    <span class="md-ellipsis">
      op
    </span>
  </a>
  
    <nav class="md-nav" aria-label="op">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.op.Op" class="md-nav__link">
    <span class="md-ellipsis">
      Op
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Op">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.op.Op.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.op.Op.gather_vars" class="md-nav__link">
    <span class="md-ellipsis">
      gather_vars
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.op.Op.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.op.SingletonTraceType" class="md-nav__link">
    <span class="md-ellipsis">
      SingletonTraceType
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.geostat.param" class="md-nav__link">
    <span class="md-ellipsis">
      param
    </span>
  </a>
  
    <nav class="md-nav" aria-label="param">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.param.Parameter" class="md-nav__link">
    <span class="md-ellipsis">
      Parameter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Parameter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.param.Parameter.create_tf_variable" class="md-nav__link">
    <span class="md-ellipsis">
      create_tf_variable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.param.Parameter.surface" class="md-nav__link">
    <span class="md-ellipsis">
      surface
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.param.bpp" class="md-nav__link">
    <span class="md-ellipsis">
      bpp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.param.get_parameter_values" class="md-nav__link">
    <span class="md-ellipsis">
      get_parameter_values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.param.ppp" class="md-nav__link">
    <span class="md-ellipsis">
      ppp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.param.upp" class="md-nav__link">
    <span class="md-ellipsis">
      upp
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.geostat.custom_op" class="md-nav__link">
    <span class="md-ellipsis">
      custom_op
    </span>
  </a>
  
    <nav class="md-nav" aria-label="custom_op">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.custom_op.function" class="md-nav__link">
    <span class="md-ellipsis">
      function
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.geostat.kernel" class="md-nav__link">
    <span class="md-ellipsis">
      kernel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="kernel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.Kernel" class="md-nav__link">
    <span class="md-ellipsis">
      Kernel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Kernel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.Kernel.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.Kernel.call" class="md-nav__link">
    <span class="md-ellipsis">
      call
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.Mix" class="md-nav__link">
    <span class="md-ellipsis">
      Mix
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.Mix.gather_vars" class="md-nav__link">
    <span class="md-ellipsis">
      gather_vars
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.Observation" class="md-nav__link">
    <span class="md-ellipsis">
      Observation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Observation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.Observation.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.block_diag" class="md-nav__link">
    <span class="md-ellipsis">
      block_diag
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.quadstack" class="md-nav__link">
    <span class="md-ellipsis">
      quadstack
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.rampstack" class="md-nav__link">
    <span class="md-ellipsis">
      rampstack
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.smooth_convex" class="md-nav__link">
    <span class="md-ellipsis">
      smooth_convex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.kernel.smooth_convex_grad" class="md-nav__link">
    <span class="md-ellipsis">
      smooth_convex_grad
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.geostat.krige" class="md-nav__link">
    <span class="md-ellipsis">
      krige
    </span>
  </a>
  
    <nav class="md-nav" aria-label="krige">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.krige.Krige" class="md-nav__link">
    <span class="md-ellipsis">
      Krige
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Krige">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.krige.Krige.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.krige.Krige.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.krige.cutoff_dist_func" class="md-nav__link">
    <span class="md-ellipsis">
      cutoff_dist_func
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.geostat.mean" class="md-nav__link">
    <span class="md-ellipsis">
      mean
    </span>
  </a>
  
    <nav class="md-nav" aria-label="mean">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.mean.Mean" class="md-nav__link">
    <span class="md-ellipsis">
      Mean
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mean">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.mean.Mean.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.geostat.mesh" class="md-nav__link">
    <span class="md-ellipsis">
      mesh
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.geostat.metric" class="md-nav__link">
    <span class="md-ellipsis">
      metric
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.geostat.model" class="md-nav__link">
    <span class="md-ellipsis">
      model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Featurizer" class="md-nav__link">
    <span class="md-ellipsis">
      Featurizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Featurizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Featurizer--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Featurizer--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Featurizer--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.GP" class="md-nav__link">
    <span class="md-ellipsis">
      GP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.GP--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.GP--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.GP--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model" class="md-nav__link">
    <span class="md-ellipsis">
      Model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.fit--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.fit--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.fit--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.fit--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.generate" class="md-nav__link">
    <span class="md-ellipsis">
      generate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="generate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.generate--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.generate--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.generate--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.generate--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
    <nav class="md-nav" aria-label="predict">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.predict--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.predict--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.predict--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.predict--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.set" class="md-nav__link">
    <span class="md-ellipsis">
      set
    </span>
  </a>
  
    <nav class="md-nav" aria-label="set">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.set--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.set--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.set--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.set--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Model.set--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.NormalizingFeaturizer" class="md-nav__link">
    <span class="md-ellipsis">
      NormalizingFeaturizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NormalizingFeaturizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.NormalizingFeaturizer--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.NormalizingFeaturizer--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.NormalizingFeaturizer--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Warp" class="md-nav__link">
    <span class="md-ellipsis">
      Warp
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Warp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.Warp.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.gp_covariance2" class="md-nav__link">
    <span class="md-ellipsis">
      gp_covariance2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.interpolate_1d_tf" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate_1d_tf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.model.mvn_log_pdf" class="md-nav__link">
    <span class="md-ellipsis">
      mvn_log_pdf
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.geostat.op" class="md-nav__link">
    <span class="md-ellipsis">
      op
    </span>
  </a>
  
    <nav class="md-nav" aria-label="op">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.op.Op" class="md-nav__link">
    <span class="md-ellipsis">
      Op
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Op">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.op.Op.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.op.Op.gather_vars" class="md-nav__link">
    <span class="md-ellipsis">
      gather_vars
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.op.Op.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.op.SingletonTraceType" class="md-nav__link">
    <span class="md-ellipsis">
      SingletonTraceType
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.geostat.param" class="md-nav__link">
    <span class="md-ellipsis">
      param
    </span>
  </a>
  
    <nav class="md-nav" aria-label="param">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.param.Parameter" class="md-nav__link">
    <span class="md-ellipsis">
      Parameter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Parameter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.geostat.param.Parameter.create_tf_variable" class="md-nav__link">
    <span class="md-ellipsis">
      create_tf_variable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.param.Parameter.surface" class="md-nav__link">
    <span class="md-ellipsis">
      surface
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.param.bpp" class="md-nav__link">
    <span class="md-ellipsis">
      bpp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.param.get_parameter_values" class="md-nav__link">
    <span class="md-ellipsis">
      get_parameter_values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.param.ppp" class="md-nav__link">
    <span class="md-ellipsis">
      ppp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.geostat.param.upp" class="md-nav__link">
    <span class="md-ellipsis">
      upp
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="api-reference">API Reference</h1>


<div class="doc doc-object doc-module">



<h2 id="src.geostat.custom_op" class="doc doc-heading">
            <code>src.geostat.custom_op</code>


</h2>

    <div class="doc doc-contents first">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.geostat.custom_op.function" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">function</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<details class="a-custom-op-involves-two-functions" open>
  <summary>A custom op involves two functions</summary>
  <ul>
<li>f, where it is defined, and</li>
<li>g, where it is introduced into the graph.</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>src/geostat/custom_op.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom op involves two functions:</span>
<span class="sd">      * f, where it is defined, and</span>
<span class="sd">      * g, where it is introduced into the graph.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
      <span class="c1"># Assume for now that all arguments are Parameters</span>
      <span class="k">return</span> <span class="n">CustomOp</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">args</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">g</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />


<div class="doc doc-object doc-module">



<h2 id="src.geostat.kernel" class="doc doc-heading">
            <code>src.geostat.kernel</code>


</h2>

    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="src.geostat.kernel.Kernel" class="doc doc-heading">
            <code>Kernel</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.geostat.op.Op" href="#src.geostat.op.Op">Op</a></code></p>


              <details class="quote">
                <summary>Source code in <code>src/geostat/kernel.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Kernel</span><span class="p">(</span><span class="n">Op</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fa</span><span class="p">,</span> <span class="n">autoinputs</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;offset&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">autoinputs</span><span class="p">:</span> <span class="n">autoinputs</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;offset&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;locs1&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">autoinputs</span><span class="p">:</span> <span class="n">autoinputs</span><span class="p">[</span><span class="s1">&#39;locs1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;locs1&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;locs2&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">autoinputs</span><span class="p">:</span> <span class="n">autoinputs</span><span class="p">[</span><span class="s1">&#39;locs2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;locs2&#39;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span> <span class="n">autoinputs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Stack</span><span class="p">([</span><span class="bp">self</span><span class="p">])</span> <span class="o">+</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Product</span><span class="p">([</span><span class="bp">self</span><span class="p">])</span> <span class="o">*</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns tuple `(mean, covariance)` for locations.</span>
<span class="sd">        Return values may be unbroadcasted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns tuple `(mean, covariance)` for locations.</span>
<span class="sd">        Return values have correct shapes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">C</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">C</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;locs1&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;locs2&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">C</span>

    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%4.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">])</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">())</span>
        <span class="k">return</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="n">string</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.geostat.kernel.Kernel.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Returns tuple <code>(mean, covariance)</code> for locations.
Return values have correct shapes.</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/kernel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns tuple `(mean, covariance)` for locations.</span>
<span class="sd">    Return values have correct shapes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">C</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">C</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;locs1&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;locs2&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">C</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.geostat.kernel.Kernel.call" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">call</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Returns tuple <code>(mean, covariance)</code> for locations.
Return values may be unbroadcasted.</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/kernel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns tuple `(mean, covariance)` for locations.</span>
<span class="sd">    Return values may be unbroadcasted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="src.geostat.kernel.Mix" class="doc doc-heading">
            <code>Mix</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.geostat.kernel.Kernel" href="#src.geostat.kernel.Kernel">Kernel</a></code></p>


              <details class="quote">
                <summary>Source code in <code>src/geostat/kernel.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Mix</span><span class="p">(</span><span class="n">Kernel</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span>
        <span class="n">fa</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ai</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cats1</span><span class="o">=</span><span class="s1">&#39;cats1&#39;</span><span class="p">,</span> <span class="n">cats2</span><span class="o">=</span><span class="s1">&#39;cats2&#39;</span><span class="p">)</span>

        <span class="c1"># Special case if weights is not given.</span>
        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fa</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span>
            <span class="n">ai</span><span class="p">[</span><span class="s1">&#39;inputs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inputs</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span> <span class="n">ai</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">gather_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a special version of gather_vars because</span>
<span class="sd">           we want to gather variables from `inputs`</span>
<span class="sd">           even when it&#39;s not in autoinputs&quot;&quot;&quot;</span>
        <span class="n">vv</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">gather_vars</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">iput</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="n">cache</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">|=</span> <span class="n">iput</span><span class="o">.</span><span class="n">gather_vars</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;weights&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">p</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span>
                      <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">get_trend_coefs</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;weights&#39;</span> <span class="ow">in</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                    <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;inputs&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># [locs, locs, numinputs].</span>
            <span class="n">Aaug1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;cats1&#39;</span><span class="p">])</span> <span class="c1"># [locs, numinputs].</span>
            <span class="n">Aaug2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;cats2&#39;</span><span class="p">])</span> <span class="c1"># [locs, numinputs].</span>
            <span class="n">outer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ac,bc-&gt;abc&#39;</span><span class="p">,</span> <span class="n">Aaug1</span><span class="p">,</span> <span class="n">Aaug2</span><span class="p">)</span> <span class="c1"># [locs, locs, numinputs].</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abc,abc-&gt;ab&#39;</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">outer</span><span class="p">)</span> <span class="c1"># [locs, locs].</span>
            <span class="k">return</span> <span class="n">C</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># When weights is not given, exploit the fact that we don&#39;t have</span>
            <span class="c1"># to compute every element in component covariance matrices.</span>
            <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>
            <span class="n">catcounts1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;cats1&#39;</span><span class="p">],</span> <span class="n">minlength</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">maxlength</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
            <span class="n">catcounts2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;cats2&#39;</span><span class="p">],</span> <span class="n">minlength</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">maxlength</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
            <span class="n">catindices1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">catcounts1</span><span class="p">,</span> <span class="n">exclusive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">catindices2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">catcounts2</span><span class="p">,</span> <span class="n">exclusive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">catdiffs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">catindices2</span> <span class="o">-</span> <span class="n">catindices1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
            <span class="n">locsegs1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;locs1&#39;</span><span class="p">],</span> <span class="n">catcounts1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
            <span class="n">locsegs2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;locs2&#39;</span><span class="p">],</span> <span class="n">catcounts2</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>

            <span class="c1"># TODO: Check that the below is still correct.</span>
            <span class="n">CC</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Observation noise submatrices.</span>
            <span class="k">for</span> <span class="n">sublocs1</span><span class="p">,</span> <span class="n">sublocs2</span><span class="p">,</span> <span class="n">catdiff</span><span class="p">,</span> <span class="n">iput</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">locsegs1</span><span class="p">,</span> <span class="n">locsegs2</span><span class="p">,</span> <span class="n">catdiffs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">):</span>
                <span class="n">cache</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">catdiff</span><span class="p">,</span>
                    <span class="n">locs1</span> <span class="o">=</span> <span class="n">sublocs1</span><span class="p">,</span>
                    <span class="n">locs2</span> <span class="o">=</span> <span class="n">sublocs2</span><span class="p">)</span>
                <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;per_axis_dist2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PerAxisDist2</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
                <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;euclidean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Euclidean</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
                <span class="n">Csub</span> <span class="o">=</span> <span class="n">iput</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
                <span class="n">CC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Csub</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">block_diag</span><span class="p">(</span><span class="n">CC</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.geostat.kernel.Mix.gather_vars" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">gather_vars</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Make a special version of gather_vars because
we want to gather variables from <code>inputs</code>
even when it's not in autoinputs</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/kernel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">gather_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make a special version of gather_vars because</span>
<span class="sd">       we want to gather variables from `inputs`</span>
<span class="sd">       even when it&#39;s not in autoinputs&quot;&quot;&quot;</span>
    <span class="n">vv</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">gather_vars</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">iput</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
        <span class="n">cache</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">|=</span> <span class="n">iput</span><span class="o">.</span><span class="n">gather_vars</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="src.geostat.kernel.Observation" class="doc doc-heading">
            <code>Observation</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.geostat.op.Op" href="#src.geostat.op.Op">Op</a></code></p>


              <details class="quote">
                <summary>Source code in <code>src/geostat/kernel.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Observation</span><span class="p">(</span><span class="n">Op</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">coefs</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
        <span class="n">noise</span><span class="p">:</span> <span class="n">Kernel</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="o">=</span> <span class="n">coefs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="o">=</span> <span class="n">noise</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">({},</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">vv</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">p</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefs</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">upp</span><span class="p">(</span><span class="n">c</span><span class="p">)}</span>
        <span class="n">vv</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">vv</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dummy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">0.</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.geostat.kernel.Observation.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Dummy.</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/kernel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dummy.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">0.</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="src.geostat.kernel.block_diag" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">block_diag</span><span class="p">(</span><span class="n">blocks</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Return a dense block-diagonal matrix.</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/kernel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">block_diag</span><span class="p">(</span><span class="n">blocks</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a dense block-diagonal matrix.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">LOBlockDiag</span><span class="p">([</span><span class="n">LOFullMatrix</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">])</span><span class="o">.</span><span class="n">to_dense</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.geostat.kernel.quadstack" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">quadstack</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sills</span><span class="p">,</span> <span class="n">ranges</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p><code>x</code> has arbitrary shape [...], but must be non-negative.
<code>sills</code> and <code>ranges</code> both have shape [K].</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/kernel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tf</span><span class="o">.</span><span class="n">recompute_grad</span>
<span class="k">def</span> <span class="nf">quadstack</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sills</span><span class="p">,</span> <span class="n">ranges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `x` has arbitrary shape [...], but must be non-negative.</span>
<span class="sd">    `sills` and `ranges` both have shape [K].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ex</span> <span class="o">=</span> <span class="n">ed</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span> <span class="o">/</span> <span class="n">ranges</span><span class="p">)</span> <span class="c1"># [..., 1]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">sills</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="c1"># [..., K]</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.geostat.kernel.rampstack" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rampstack</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sills</span><span class="p">,</span> <span class="n">ranges</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p><code>x</code> has arbitrary shape [...], but must be non-negative.
<code>sills</code> and <code>ranges</code> both have shape [K].</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/kernel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tf</span><span class="o">.</span><span class="n">custom_gradient</span>
<span class="k">def</span> <span class="nf">rampstack</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sills</span><span class="p">,</span> <span class="n">ranges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `x` has arbitrary shape [...], but must be non-negative.</span>
<span class="sd">    `sills` and `ranges` both have shape [K].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">ed</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># [..., 1]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">sills</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">ax</span> <span class="o">/</span> <span class="n">ranges</span><span class="p">)</span> <span class="c1"># [..., K]</span>
    <span class="k">def</span> <span class="nf">grad</span><span class="p">(</span><span class="n">upstream</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ed</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># [..., 1]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">sills</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">ax</span> <span class="o">/</span> <span class="n">ranges</span><span class="p">)</span> <span class="c1"># [..., K]</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">sills</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">small</span> <span class="o">=</span> <span class="n">ax</span> <span class="o">&lt;</span> <span class="n">ranges</span>
        <span class="n">grad_x</span> <span class="o">=</span> <span class="n">upstream</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">small</span><span class="p">,</span> <span class="o">-</span><span class="n">tf</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">ed</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">sills</span> <span class="o">/</span> <span class="n">ranges</span><span class="p">),</span> <span class="mf">0.</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># [...]</span>
        <span class="n">grad_sills</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ak,a-&gt;k&#39;</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">K</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">upstream</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">grad_ranges</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">small</span><span class="p">,</span> <span class="n">ax</span> <span class="o">*</span> <span class="p">(</span><span class="n">sills</span> <span class="o">/</span> <span class="n">tf</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">ranges</span><span class="p">)),</span> <span class="mf">0.</span><span class="p">)</span> <span class="c1"># [..., K}</span>
        <span class="n">grad_ranges</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ak,a-&gt;k&#39;</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">grad_ranges</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">K</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">upstream</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">grad_x</span><span class="p">,</span> <span class="n">grad_sills</span><span class="p">,</span> <span class="n">grad_ranges</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">grad</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.geostat.kernel.smooth_convex" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">smooth_convex</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sills</span><span class="p">,</span> <span class="n">ranges</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p><code>x</code> has arbitrary shape [...], but must be non-negative.
<code>sills</code> and <code>ranges</code> both have shape [K].</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/kernel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tf</span><span class="o">.</span><span class="n">recompute_grad</span>
<span class="k">def</span> <span class="nf">smooth_convex</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sills</span><span class="p">,</span> <span class="n">ranges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `x` has arbitrary shape [...], but must be non-negative.</span>
<span class="sd">    `sills` and `ranges` both have shape [K].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">ranges</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">ranges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
    <span class="n">ex</span> <span class="o">=</span> <span class="n">ed</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
    <span class="n">rx</span> <span class="o">=</span> <span class="n">ax</span> <span class="o">/</span> <span class="n">r2</span> <span class="o">-</span> <span class="mf">1.</span>

    <span class="n">c1</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">/</span> <span class="p">(</span><span class="n">r1</span> <span class="o">+</span> <span class="n">r2</span><span class="p">)</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">r1</span><span class="o">/</span><span class="n">r2</span><span class="p">))</span>

    <span class="c1"># i1 = tf.cast(ax &lt;= r1, tf.float32) # Indicates x &lt;= r1.</span>
    <span class="c1"># i2 = tf.cast(ax &lt;= r2, tf.float32) * (1. - i1) # Indicates r1 &lt; x &lt;= r2.</span>
    <span class="c1"># v = i1 * (1. - c1 * ax) + i2 * c2 * tf.square(rx)</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ax</span> <span class="o">&lt;=</span> <span class="n">r1</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">ax</span><span class="p">,</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">rx</span><span class="p">))</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ax</span> <span class="o">&lt;=</span> <span class="n">r2</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...k,k-&gt;...&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">sills</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.geostat.kernel.smooth_convex_grad" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">smooth_convex_grad</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sills</span><span class="p">,</span> <span class="n">ranges</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p><code>x</code> has arbitrary shape [...], but must be non-negative.
<code>sills</code> and <code>ranges</code> both have shape [K].</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/kernel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tf</span><span class="o">.</span><span class="n">custom_gradient</span>
<span class="k">def</span> <span class="nf">smooth_convex_grad</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sills</span><span class="p">,</span> <span class="n">ranges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `x` has arbitrary shape [...], but must be non-negative.</span>
<span class="sd">    `sills` and `ranges` both have shape [K].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">ranges</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">ranges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
    <span class="n">ex</span> <span class="o">=</span> <span class="n">ed</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
    <span class="n">rx</span> <span class="o">=</span> <span class="n">ax</span> <span class="o">/</span> <span class="n">r2</span> <span class="o">-</span> <span class="mf">1.</span>

    <span class="n">c1</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">/</span> <span class="p">(</span><span class="n">r1</span> <span class="o">+</span> <span class="n">r2</span><span class="p">)</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">r1</span><span class="o">/</span><span class="n">r2</span><span class="p">))</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ax</span> <span class="o">&lt;=</span> <span class="n">r1</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">ax</span><span class="p">,</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">rx</span><span class="p">))</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ax</span> <span class="o">&lt;=</span> <span class="n">r2</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...k,k-&gt;...&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">sills</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">grad</span><span class="p">(</span><span class="n">upstream</span><span class="p">):</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">ranges</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">ranges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="n">ex</span> <span class="o">=</span> <span class="n">ed</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
        <span class="n">rx</span> <span class="o">=</span> <span class="n">ax</span> <span class="o">/</span> <span class="n">r2</span> <span class="o">-</span> <span class="mf">1.</span>
        <span class="n">i1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">ax</span> <span class="o">&lt;=</span> <span class="n">r1</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="c1"># Indicates x &lt;= r1.</span>
        <span class="n">i2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">ax</span> <span class="o">&lt;=</span> <span class="n">r2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">i1</span><span class="p">)</span> <span class="c1"># Indicates r1 &lt; x &lt;= r2.</span>

        <span class="n">c1</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">/</span> <span class="p">(</span><span class="n">r1</span> <span class="o">+</span> <span class="n">r2</span><span class="p">)</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">r1</span> <span class="o">/</span> <span class="n">r2</span><span class="p">))</span>
        <span class="n">c3</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">r2</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span> <span class="o">/</span> <span class="n">r2</span><span class="p">)</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">ax</span><span class="p">)</span> <span class="o">+</span> <span class="n">i2</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>

        <span class="n">sx</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>

        <span class="n">K</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">sills</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">gx</span> <span class="o">=</span> <span class="n">sx</span> <span class="o">*</span> <span class="n">sills</span> <span class="o">*</span> <span class="p">(</span><span class="n">i1</span> <span class="o">*</span> <span class="o">-</span><span class="n">c1</span> <span class="o">+</span> <span class="n">i2</span> <span class="o">*</span> <span class="n">rx</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">c3</span><span class="p">))</span>
        <span class="n">grad_x</span> <span class="o">=</span> <span class="n">upstream</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">gx</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># [...]</span>

        <span class="n">grad_sills</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ak,a-&gt;k&#39;</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">K</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">upstream</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">u</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">tf</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">r1</span> <span class="o">+</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">ax</span> <span class="o">*</span> <span class="n">i1</span>
        <span class="n">yr1</span> <span class="o">=</span> <span class="n">u</span> <span class="o">+</span> <span class="n">i2</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">rx</span> <span class="o">*</span> <span class="n">c3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">r1</span>
        <span class="n">yr2</span> <span class="o">=</span> <span class="n">u</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i2</span> <span class="o">*</span> <span class="p">(</span><span class="n">rx</span> <span class="o">*</span> <span class="n">c3</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">rx</span> <span class="o">*</span> <span class="n">c2</span><span class="p">)</span> <span class="o">/</span> <span class="n">r2</span><span class="p">)</span>
        <span class="n">yr1</span> <span class="o">=</span> <span class="n">sills</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">yr1</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">K</span><span class="p">])</span>
        <span class="n">yr2</span> <span class="o">=</span> <span class="n">sills</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">yr2</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">K</span><span class="p">])</span>
        <span class="n">yr</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">yr1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:],</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span> <span class="o">+</span> <span class="n">yr2</span>
        <span class="n">grad_ranges</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ak,a-&gt;k&#39;</span><span class="p">,</span> <span class="n">yr</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">upstream</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">grad_x</span><span class="p">,</span> <span class="n">grad_sills</span><span class="p">,</span> <span class="n">grad_ranges</span>

    <span class="k">return</span> <span class="n">y</span><span class="p">,</span> <span class="n">grad</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />


<div class="doc doc-object doc-module">



<h2 id="src.geostat.krige" class="doc doc-heading">
            <code>src.geostat.krige</code>


</h2>

    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="src.geostat.krige.Krige" class="doc doc-heading">
            <code>Krige</code>


</h3>


    <div class="doc doc-contents ">


              <details class="quote">
                <summary>Source code in <code>src/geostat/krige.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Krige</span><span class="p">():</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">x1</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> 
                 <span class="n">bins</span><span class="p">,</span>
                 <span class="n">variogram_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">variogram_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">cutoff_dist</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                 <span class="n">featurization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">projection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">show_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                 <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters:</span>
<span class="sd">                x1 : n-dim array</span>
<span class="sd">                    Locations of input data.</span>

<span class="sd">                u1 : 1-d array</span>
<span class="sd">                    Values to be kriged.</span>

<span class="sd">                bins : int or None</span>
<span class="sd">                    The number of bins to use on the variogram cloud.</span>
<span class="sd">                    If None, variogram function is fit to the variogram cloud</span>
<span class="sd">                    and is not binned first.</span>

<span class="sd">                variogram_func : str</span>
<span class="sd">                     Name of the variogram model to use in the kriging. </span>
<span class="sd">                     Should be &#39;linear&#39;, &#39;gaussian&#39;, or &#39;spherical&#39;.</span>
<span class="sd">                     Default is &#39;gaussian&#39;.</span>

<span class="sd">                cutoff_dist : str or int, optional</span>
<span class="sd">                    The maximum lag distance to include in variogram modeling.</span>

<span class="sd">                featurization : function, optional</span>
<span class="sd">                    Should be a function that takes x1 (n-dim array of input data) </span>
<span class="sd">                    and returns the coordinates, i.e., x, y, x**2, y**2.</span>
<span class="sd">                    Example below.</span>
<span class="sd">                    Default is None.</span>

<span class="sd">                project : function, opt</span>
<span class="sd">                    A function that takes multiple vectors, and returns</span>
<span class="sd">                    a tuple of projected vectors.</span>

<span class="sd">                epsg_proj : str</span>
<span class="sd">                    The projected coordinate system to use. Ignored if project=False.</span>
<span class="sd">                    Default is &#39;EPSG:3310&#39; (California Albers).</span>

<span class="sd">                show_plots : boolean, optional</span>
<span class="sd">                    Whether or not to show variogram plots.</span>
<span class="sd">                    Default is True.</span>

<span class="sd">                verbose : boolean, optional</span>
<span class="sd">                    Whether or not to print parameters.</span>
<span class="sd">                    Default is True.</span>


<span class="sd">        Performs experimental variogram calculation, bins data, and fits variogram model to estimate variogram parameters.       </span>

<span class="sd">        Performs ordinary and universal kriging in up to 3 spatial dimensions.</span>


<span class="sd">        Trend model example:</span>
<span class="sd">        def featurization(x1):    </span>
<span class="sd">            return x1[:, 0], x1[:, 1], x1[:, 0]**2, x1[:, 1]**2</span>


<span class="sd">        &#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>

        <span class="c1"># Save original x1 for stats function.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x1_original</span> <span class="o">=</span> <span class="n">x1</span>

        <span class="c1"># Check and change the shape of u1 if needed (for pdist).</span>
        <span class="k">if</span> <span class="n">u1</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u1</span> <span class="o">=</span> <span class="n">u1</span>
        <span class="k">elif</span> <span class="n">u1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u1</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Check dimensions of &#39;u1&#39;.&quot;</span><span class="p">)</span>

        <span class="c1"># Projection.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>

        <span class="c1"># Variogram.</span>
        <span class="k">if</span> <span class="n">variogram_func</span> <span class="o">==</span> <span class="s1">&#39;gaussian&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">=</span> <span class="n">gaussian</span>
        <span class="k">elif</span> <span class="n">variogram_func</span> <span class="o">==</span> <span class="s1">&#39;spherical&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">=</span> <span class="n">spherical</span>
        <span class="k">elif</span> <span class="n">variogram_func</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">=</span> <span class="n">linear</span>
        <span class="k">else</span><span class="p">:</span>  
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Variogram function must be &#39;linear&#39;, &#39;gaussian&#39;, or &#39;spherical&#39;.&quot;</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">cutoff_dist</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span> <span class="o">=</span> <span class="n">cutoff_dist_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span> <span class="o">=</span> <span class="n">cutoff_dist</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="n">show_plots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featurization</span> <span class="o">=</span> <span class="n">featurization</span>


        <span class="c1"># Lags and semivariance.</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">pdist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">)</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">pdist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;sqeuclidean&#39;</span><span class="p">)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Use bins.</span>
            <span class="c1"># Variogram cloud calculation.</span>
            <span class="n">bin_means</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">binnumber</span> <span class="o">=</span> <span class="n">binned_statistic</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> 
                                                               <span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> 
                                                               <span class="n">bins</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">,</span> 
                                                               <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">dist</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> 
                                                                      <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">])</span>
            <span class="n">bin_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">bin_centers</span> <span class="o">=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">bin_width</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="c1"># Bin counts calculation.</span>
            <span class="n">bin_count</span><span class="p">,</span> <span class="n">bin_count_edges</span><span class="p">,</span> <span class="n">bin_count_number</span> <span class="o">=</span> <span class="n">binned_statistic</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> 
                                                                            <span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> 
                                                                            <span class="n">bins</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">)</span>
            <span class="n">bin_count_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_count_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bin_count_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">bin_count_centers</span> <span class="o">=</span> <span class="n">bin_count_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">bin_count_width</span><span class="o">/</span><span class="mi">2</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>

                <span class="c1"># Variogram cloud plot.</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>

                <span class="c1"># Variogram cloud plot.</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">bin_means</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">bin_means</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                <span class="c1"># Bin counts plot.</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">bin_count</span><span class="p">,</span> <span class="n">bin_count_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bin_count_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bin_count_centers</span><span class="p">,</span> <span class="n">bin_count</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Bin count&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>



        <span class="c1">############ Fit the variogram model.</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">variogram_params</span><span class="p">:</span>  <span class="c1"># Fit to the data.</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Fit the variogram cloud.</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">==</span> <span class="n">gaussian</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">==</span> <span class="n">spherical</span><span class="p">:</span>

                    <span class="c1"># Initial guess for the parameters.</span>
                    <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span>            <span class="c1"># range</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span>  <span class="c1"># sill</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">]</span>           <span class="c1"># nugget</span>

                    <span class="c1"># Bounds with constraints.</span>
                    <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)]</span>

                    <span class="c1"># Apply the cutoff.</span>
                    <span class="n">dist_cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                    <span class="n">gamma_cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

                    <span class="c1"># Remove nans for curve_fit.</span>
                    <span class="n">dist_cut</span> <span class="o">=</span> <span class="n">dist_cut</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dist_cut</span><span class="p">)]</span>
                    <span class="n">gamma_cut</span> <span class="o">=</span> <span class="n">gamma_cut</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">gamma_cut</span><span class="p">)]</span>

                    <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">,</span> <span class="n">dist_cut</span><span class="p">,</span> <span class="n">gamma_cut</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

                        <span class="c1"># Calculate 2d kde to help confirm cutoff.</span>
                        <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span> <span class="mi">60</span><span class="p">)</span>
                        <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="mi">60</span><span class="p">)</span>
                        <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
                        <span class="n">xyi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">xi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">yi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

                        <span class="n">kde</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">([</span><span class="n">dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">])</span>
                        <span class="n">z</span> <span class="o">=</span> <span class="n">kde</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">xyi</span><span class="p">)</span>
                        <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">yi</span><span class="p">))</span>

                        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                        <span class="c1"># With cutoff and variogram model.</span>
                        <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dist_cut</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dist_cut</span><span class="p">,</span> <span class="n">gamma_cut</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


                    <span class="n">vrange</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">sill</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">nugget</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>


                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;variogram model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variogram_func</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;range: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vrange</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sill: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sill</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nugget: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nugget</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;full sill: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sill</span> <span class="o">+</span> <span class="n">nugget</span><span class="p">))</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">vrange</span><span class="p">,</span> <span class="n">sill</span><span class="p">,</span> <span class="n">nugget</span><span class="p">]</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">==</span> <span class="n">linear</span><span class="p">:</span>

                    <span class="c1"># Initial guess for the parameters.</span>
                    <span class="n">p0</span> <span class="o">=</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dist</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gamma</span><span class="p">)),</span>  <span class="c1"># slope</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">]</span>                                             <span class="c1"># nugget</span>

                    <span class="c1"># Bounds with constraints.</span>
                    <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)]</span>

                    <span class="c1"># Apply the cutoff.</span>
                    <span class="n">dist_cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                    <span class="n">gamma_cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

                    <span class="c1"># Remove nans for curve_fit.</span>
                    <span class="n">dist_cut</span> <span class="o">=</span> <span class="n">dist_cut</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dist_cut</span><span class="p">)]</span>
                    <span class="n">gamma_cut</span> <span class="o">=</span> <span class="n">gamma_cut</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">gamma_cut</span><span class="p">)]</span>

                    <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">,</span> <span class="n">dist_cut</span><span class="p">,</span> <span class="n">gamma_cut</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

                        <span class="c1"># Calculate 2d kde to help confirm cutoff.</span>
                        <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span> <span class="mi">60</span><span class="p">)</span>
                        <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="mi">60</span><span class="p">)</span>
                        <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
                        <span class="n">xyi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">xi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">yi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

                        <span class="n">kde</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">([</span><span class="n">dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">])</span>
                        <span class="n">z</span> <span class="o">=</span> <span class="n">kde</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">xyi</span><span class="p">)</span>
                        <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">yi</span><span class="p">))</span>

                        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                        <span class="c1"># With cutoff and variogram model.</span>
                        <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dist_cut</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dist_cut</span><span class="p">,</span> <span class="n">gamma_cut</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


                    <span class="n">slope</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">nugget</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;variogram model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variogram_func</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;slope: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slope</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nugget: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nugget</span><span class="p">))</span>


                    <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">slope</span><span class="p">,</span> <span class="n">nugget</span><span class="p">]</span>




            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Fit the binned data.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">==</span> <span class="n">gaussian</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">==</span> <span class="n">spherical</span><span class="p">:</span>

                    <span class="c1"># Initial guess for the parameters.</span>
                    <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">),</span>                 <span class="c1"># range</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bin_means</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">bin_means</span><span class="p">),</span>  <span class="c1"># sill</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">bin_means</span><span class="p">)]</span>                      <span class="c1"># nugget</span>

                    <span class="c1"># Bounds with constraints.</span>
                    <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)]</span>

                    <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">,</span> <span class="n">bin_centers</span><span class="p">,</span> <span class="n">bin_means</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

                        <span class="c1"># Fit variogram plot.</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">bin_means</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                    <span class="n">vrange</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">sill</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">nugget</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>


                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;variogram model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variogram_func</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;range: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vrange</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sill: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sill</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nugget: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nugget</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;full sill: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sill</span> <span class="o">+</span> <span class="n">nugget</span><span class="p">))</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">vrange</span><span class="p">,</span> <span class="n">sill</span><span class="p">,</span> <span class="n">nugget</span><span class="p">]</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">==</span> <span class="n">linear</span><span class="p">:</span>

                    <span class="c1"># Initial guess for the parameters.</span>
                    <span class="n">p0</span> <span class="o">=</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bin_means</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">bin_means</span><span class="p">)),</span>  <span class="c1"># slope</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">bin_means</span><span class="p">)]</span>                                                                      <span class="c1"># nugget</span>

                    <span class="c1"># Bounds with constraints.</span>
                    <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)]</span>

                    <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">,</span> <span class="n">bin_centers</span><span class="p">,</span> <span class="n">bin_means</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

                        <span class="c1"># Fit variogram plot.</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">bin_means</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                    <span class="n">slope</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">nugget</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;variogram model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variogram_func</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;slope: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slope</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nugget: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nugget</span><span class="p">))</span>


                    <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">slope</span><span class="p">,</span> <span class="n">nugget</span><span class="p">]</span>


        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Use the given variogram parameters.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span> <span class="o">=</span> <span class="n">variogram_params</span>

            <span class="c1"># Apply the cutoff.</span>
            <span class="n">dist_cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">gamma_cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

            <span class="c1"># Remove nans for curve_fit.</span>
            <span class="n">dist_cut</span> <span class="o">=</span> <span class="n">dist_cut</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dist_cut</span><span class="p">)]</span>
            <span class="n">gamma_cut</span> <span class="o">=</span> <span class="n">gamma_cut</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">gamma_cut</span><span class="p">)]</span>


            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>

                    <span class="c1"># Calculate 2d kde to help confirm cutoff.</span>
                    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span> <span class="mi">60</span><span class="p">)</span>
                    <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="mi">60</span><span class="p">)</span>
                    <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
                    <span class="n">xyi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">xi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">yi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

                    <span class="n">kde</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">([</span><span class="n">dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">])</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="n">kde</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">xyi</span><span class="p">)</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">yi</span><span class="p">))</span>

                    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                    <span class="c1"># With cutoff and variogram model.</span>
                    <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dist_cut</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dist_cut</span><span class="p">,</span> <span class="n">gamma_cut</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="c1"># Fit variogram plot.</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">bin_means</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">==</span> <span class="n">gaussian</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">==</span> <span class="n">spherical</span><span class="p">:</span>
                <span class="n">vrange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">sill</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">nugget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;variogram model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variogram_func</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;range: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vrange</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sill: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sill</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nugget: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nugget</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;full sill: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sill</span> <span class="o">+</span> <span class="n">nugget</span><span class="p">))</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">==</span> <span class="n">linear</span><span class="p">:</span>
                <span class="n">slope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">nugget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;variogram model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variogram_func</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;slope: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slope</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nugget: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nugget</span><span class="p">))</span>




<span class="c1">####################################################</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x2_pred</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters:</span>
<span class="sd">                x2 : n-dim array</span>
<span class="sd">                    Locations to make kriging predictions.</span>

<span class="sd">        Returns:</span>
<span class="sd">                u2_mean : float</span>
<span class="sd">                    Kriging mean.</span>

<span class="sd">                u2_var : float</span>
<span class="sd">                    Kriging variance.</span>


<span class="sd">        Performs ordinary or universal kriging using the estimated variogram parameters.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">x2_pred</span><span class="p">)</span>

        <span class="n">n1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x2</span><span class="p">)</span>

        <span class="c1"># Universal krige.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurization</span><span class="p">:</span>            
            <span class="c1"># Ax = b with a trend.</span>

            <span class="c1"># Build A</span>
            <span class="n">D1</span> <span class="o">=</span> <span class="n">cdist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>

            <span class="n">drift_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurization</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)))</span>

            <span class="n">An</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">drift_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">An</span><span class="p">,</span> <span class="n">An</span><span class="p">))</span>
            <span class="n">A</span><span class="p">[:</span><span class="n">n1</span><span class="p">,</span> <span class="p">:</span><span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">D1</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
            <span class="n">A</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="p">:</span><span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">A</span><span class="p">[:</span><span class="n">n1</span><span class="p">,</span> <span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">A</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

            <span class="c1"># Add in the trend for A.</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">drift_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">A</span><span class="p">[</span><span class="n">n1</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="n">drift_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">A</span><span class="p">[:</span><span class="n">n1</span><span class="p">,</span> <span class="n">n1</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">drift_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c1"># Build b.</span>
            <span class="n">D2</span> <span class="o">=</span> <span class="n">cdist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">D2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">D2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">drift_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">b</span><span class="p">[:</span><span class="n">n2</span><span class="p">,</span> <span class="p">:</span><span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">D2</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">T</span>
            <span class="n">b</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">1.</span>

            <span class="c1"># Add the trend for b.</span>
            <span class="n">drift_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurization</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x2</span><span class="p">)))</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">drift_pred</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">b</span><span class="p">[</span><span class="n">n1</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">drift_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c1"># Solve.</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

            <span class="n">u2_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tensordot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u1</span><span class="p">,</span> <span class="n">x</span><span class="p">[:</span><span class="n">n1</span><span class="p">],</span> <span class="n">axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">u2_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="o">-</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">u2_mean</span><span class="p">,</span> <span class="n">u2_var</span>


        <span class="c1"># Ordinary krige.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Ax = b.</span>

            <span class="c1"># Build A.</span>
            <span class="n">D1</span> <span class="o">=</span> <span class="n">cdist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n1</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">A</span><span class="p">[:</span><span class="n">n1</span><span class="p">,</span> <span class="p">:</span><span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">D1</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
            <span class="n">A</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">A</span><span class="p">[:,</span> <span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">A</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

            <span class="c1"># Build b.</span>
            <span class="n">D2</span> <span class="o">=</span> <span class="n">cdist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">D2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">D2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">b</span><span class="p">[:</span><span class="n">n2</span><span class="p">,</span> <span class="p">:</span><span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">D2</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">T</span>
            <span class="n">b</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">1.</span>

            <span class="c1"># Solve.</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

            <span class="n">u2_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tensordot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u1</span><span class="p">,</span> <span class="n">x</span><span class="p">[:</span><span class="n">n1</span><span class="p">],</span> <span class="n">axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">u2_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="o">-</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">u2_mean</span><span class="p">,</span> <span class="n">u2_var</span>

    <span class="c1">#########################################################</span>
    <span class="c1"># Access the projected coords of the input data.</span>
    <span class="k">def</span> <span class="nf">get_projected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1">#########################################################   </span>
    <span class="c1"># Provide some stats on the model.</span>
    <span class="k">def</span> <span class="nf">stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>         

        <span class="n">u2_mean_for_u1</span><span class="p">,</span> <span class="n">u2_var_for_u1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x1_original</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u1</span> <span class="o">-</span> <span class="n">u2_mean_for_u1</span>     

        <span class="bp">self</span><span class="o">.</span><span class="n">res_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_skew</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_kurt</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">kurtosis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input values&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Input values&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Residuals&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Residuals&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Residual mean: </span><span class="si">{:.3e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_mean</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Residual standard deviation: </span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_std</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Residual skewness: </span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_skew</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Residual kurtosis: </span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_kurt</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_residuals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span>

    <span class="k">def</span> <span class="nf">get_residual_moments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_mean</span><span class="p">,</span> 
                    <span class="n">std</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_std</span><span class="p">,</span> 
                    <span class="n">skew</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_skew</span><span class="p">,</span> 
                    <span class="n">kurt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_kurt</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.geostat.krige.Krige.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">variogram_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">variogram_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutoff_dist</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">featurization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>x1</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>n-dim array
Locations of input data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>u1</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1-d array
Values to be kriged.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>bins</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int or None
The number of bins to use on the variogram cloud.
If None, variogram function is fit to the variogram cloud
and is not binned first.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>variogram_func</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>str
Name of the variogram model to use in the kriging. 
Should be 'linear', 'gaussian', or 'spherical'.
Default is 'gaussian'.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cutoff_dist</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>str or int, optional
The maximum lag distance to include in variogram modeling.</p>
              </div>
            </td>
            <td>
                  <code>&#39;auto&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>featurization</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>function, optional
Should be a function that takes x1 (n-dim array of input data) 
and returns the coordinates, i.e., x, y, x<strong>2, y</strong>2.
Example below.
Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>project</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>function, opt
A function that takes multiple vectors, and returns
a tuple of projected vectors.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>epsg_proj</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>str
The projected coordinate system to use. Ignored if project=False.
Default is 'EPSG:3310' (California Albers).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>show_plots</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>boolean, optional
Whether or not to show variogram plots.
Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>verbose</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>boolean, optional
Whether or not to print parameters.
Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Performs experimental variogram calculation, bins data, and fits variogram model to estimate variogram parameters.       </p>
<p>Performs ordinary and universal kriging in up to 3 spatial dimensions.</p>
<p>Trend model example:
def featurization(x1):  <br />
    return x1[:, 0], x1[:, 1], x1[:, 0]<strong>2, x1[:, 1]</strong>2</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/krige.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
             <span class="n">x1</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> 
             <span class="n">bins</span><span class="p">,</span>
             <span class="n">variogram_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
             <span class="n">variogram_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
             <span class="n">cutoff_dist</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
             <span class="n">featurization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">projection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">show_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
             <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="p">):</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">            x1 : n-dim array</span>
<span class="sd">                Locations of input data.</span>

<span class="sd">            u1 : 1-d array</span>
<span class="sd">                Values to be kriged.</span>

<span class="sd">            bins : int or None</span>
<span class="sd">                The number of bins to use on the variogram cloud.</span>
<span class="sd">                If None, variogram function is fit to the variogram cloud</span>
<span class="sd">                and is not binned first.</span>

<span class="sd">            variogram_func : str</span>
<span class="sd">                 Name of the variogram model to use in the kriging. </span>
<span class="sd">                 Should be &#39;linear&#39;, &#39;gaussian&#39;, or &#39;spherical&#39;.</span>
<span class="sd">                 Default is &#39;gaussian&#39;.</span>

<span class="sd">            cutoff_dist : str or int, optional</span>
<span class="sd">                The maximum lag distance to include in variogram modeling.</span>

<span class="sd">            featurization : function, optional</span>
<span class="sd">                Should be a function that takes x1 (n-dim array of input data) </span>
<span class="sd">                and returns the coordinates, i.e., x, y, x**2, y**2.</span>
<span class="sd">                Example below.</span>
<span class="sd">                Default is None.</span>

<span class="sd">            project : function, opt</span>
<span class="sd">                A function that takes multiple vectors, and returns</span>
<span class="sd">                a tuple of projected vectors.</span>

<span class="sd">            epsg_proj : str</span>
<span class="sd">                The projected coordinate system to use. Ignored if project=False.</span>
<span class="sd">                Default is &#39;EPSG:3310&#39; (California Albers).</span>

<span class="sd">            show_plots : boolean, optional</span>
<span class="sd">                Whether or not to show variogram plots.</span>
<span class="sd">                Default is True.</span>

<span class="sd">            verbose : boolean, optional</span>
<span class="sd">                Whether or not to print parameters.</span>
<span class="sd">                Default is True.</span>


<span class="sd">    Performs experimental variogram calculation, bins data, and fits variogram model to estimate variogram parameters.       </span>

<span class="sd">    Performs ordinary and universal kriging in up to 3 spatial dimensions.</span>


<span class="sd">    Trend model example:</span>
<span class="sd">    def featurization(x1):    </span>
<span class="sd">        return x1[:, 0], x1[:, 1], x1[:, 0]**2, x1[:, 1]**2</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>

    <span class="c1"># Save original x1 for stats function.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x1_original</span> <span class="o">=</span> <span class="n">x1</span>

    <span class="c1"># Check and change the shape of u1 if needed (for pdist).</span>
    <span class="k">if</span> <span class="n">u1</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u1</span> <span class="o">=</span> <span class="n">u1</span>
    <span class="k">elif</span> <span class="n">u1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u1</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Check dimensions of &#39;u1&#39;.&quot;</span><span class="p">)</span>

    <span class="c1"># Projection.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>

    <span class="c1"># Variogram.</span>
    <span class="k">if</span> <span class="n">variogram_func</span> <span class="o">==</span> <span class="s1">&#39;gaussian&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">=</span> <span class="n">gaussian</span>
    <span class="k">elif</span> <span class="n">variogram_func</span> <span class="o">==</span> <span class="s1">&#39;spherical&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">=</span> <span class="n">spherical</span>
    <span class="k">elif</span> <span class="n">variogram_func</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">=</span> <span class="n">linear</span>
    <span class="k">else</span><span class="p">:</span>  
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Variogram function must be &#39;linear&#39;, &#39;gaussian&#39;, or &#39;spherical&#39;.&quot;</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">cutoff_dist</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span> <span class="o">=</span> <span class="n">cutoff_dist_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span> <span class="o">=</span> <span class="n">cutoff_dist</span>


    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="n">show_plots</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">featurization</span> <span class="o">=</span> <span class="n">featurization</span>


    <span class="c1"># Lags and semivariance.</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">pdist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">)</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">pdist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;sqeuclidean&#39;</span><span class="p">)</span>


    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Use bins.</span>
        <span class="c1"># Variogram cloud calculation.</span>
        <span class="n">bin_means</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">binnumber</span> <span class="o">=</span> <span class="n">binned_statistic</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> 
                                                           <span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> 
                                                           <span class="n">bins</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">,</span> 
                                                           <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">dist</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> 
                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">])</span>
        <span class="n">bin_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">bin_centers</span> <span class="o">=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">bin_width</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># Bin counts calculation.</span>
        <span class="n">bin_count</span><span class="p">,</span> <span class="n">bin_count_edges</span><span class="p">,</span> <span class="n">bin_count_number</span> <span class="o">=</span> <span class="n">binned_statistic</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> 
                                                                        <span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> 
                                                                        <span class="n">bins</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">)</span>
        <span class="n">bin_count_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_count_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bin_count_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">bin_count_centers</span> <span class="o">=</span> <span class="n">bin_count_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">bin_count_width</span><span class="o">/</span><span class="mi">2</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># Variogram cloud plot.</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># Variogram cloud plot.</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">bin_means</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">bin_means</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="c1"># Bin counts plot.</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">bin_count</span><span class="p">,</span> <span class="n">bin_count_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bin_count_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bin_count_centers</span><span class="p">,</span> <span class="n">bin_count</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Bin count&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>



    <span class="c1">############ Fit the variogram model.</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">variogram_params</span><span class="p">:</span>  <span class="c1"># Fit to the data.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Fit the variogram cloud.</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">==</span> <span class="n">gaussian</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">==</span> <span class="n">spherical</span><span class="p">:</span>

                <span class="c1"># Initial guess for the parameters.</span>
                <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span>            <span class="c1"># range</span>
                      <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span>  <span class="c1"># sill</span>
                      <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">]</span>           <span class="c1"># nugget</span>

                <span class="c1"># Bounds with constraints.</span>
                <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)]</span>

                <span class="c1"># Apply the cutoff.</span>
                <span class="n">dist_cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="n">gamma_cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

                <span class="c1"># Remove nans for curve_fit.</span>
                <span class="n">dist_cut</span> <span class="o">=</span> <span class="n">dist_cut</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dist_cut</span><span class="p">)]</span>
                <span class="n">gamma_cut</span> <span class="o">=</span> <span class="n">gamma_cut</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">gamma_cut</span><span class="p">)]</span>

                <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">,</span> <span class="n">dist_cut</span><span class="p">,</span> <span class="n">gamma_cut</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

                    <span class="c1"># Calculate 2d kde to help confirm cutoff.</span>
                    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span> <span class="mi">60</span><span class="p">)</span>
                    <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="mi">60</span><span class="p">)</span>
                    <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
                    <span class="n">xyi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">xi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">yi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

                    <span class="n">kde</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">([</span><span class="n">dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">])</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="n">kde</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">xyi</span><span class="p">)</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">yi</span><span class="p">))</span>

                    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                    <span class="c1"># With cutoff and variogram model.</span>
                    <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dist_cut</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dist_cut</span><span class="p">,</span> <span class="n">gamma_cut</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


                <span class="n">vrange</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">sill</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">nugget</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>


                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;variogram model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variogram_func</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;range: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vrange</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sill: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sill</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nugget: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nugget</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;full sill: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sill</span> <span class="o">+</span> <span class="n">nugget</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">vrange</span><span class="p">,</span> <span class="n">sill</span><span class="p">,</span> <span class="n">nugget</span><span class="p">]</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">==</span> <span class="n">linear</span><span class="p">:</span>

                <span class="c1"># Initial guess for the parameters.</span>
                <span class="n">p0</span> <span class="o">=</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dist</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gamma</span><span class="p">)),</span>  <span class="c1"># slope</span>
                      <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">]</span>                                             <span class="c1"># nugget</span>

                <span class="c1"># Bounds with constraints.</span>
                <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)]</span>

                <span class="c1"># Apply the cutoff.</span>
                <span class="n">dist_cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="n">gamma_cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

                <span class="c1"># Remove nans for curve_fit.</span>
                <span class="n">dist_cut</span> <span class="o">=</span> <span class="n">dist_cut</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dist_cut</span><span class="p">)]</span>
                <span class="n">gamma_cut</span> <span class="o">=</span> <span class="n">gamma_cut</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">gamma_cut</span><span class="p">)]</span>

                <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">,</span> <span class="n">dist_cut</span><span class="p">,</span> <span class="n">gamma_cut</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

                    <span class="c1"># Calculate 2d kde to help confirm cutoff.</span>
                    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span> <span class="mi">60</span><span class="p">)</span>
                    <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="mi">60</span><span class="p">)</span>
                    <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
                    <span class="n">xyi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">xi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">yi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

                    <span class="n">kde</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">([</span><span class="n">dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">])</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="n">kde</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">xyi</span><span class="p">)</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">yi</span><span class="p">))</span>

                    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                    <span class="c1"># With cutoff and variogram model.</span>
                    <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dist_cut</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dist_cut</span><span class="p">,</span> <span class="n">gamma_cut</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


                <span class="n">slope</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">nugget</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;variogram model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variogram_func</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;slope: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slope</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nugget: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nugget</span><span class="p">))</span>


                <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">slope</span><span class="p">,</span> <span class="n">nugget</span><span class="p">]</span>




        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Fit the binned data.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">==</span> <span class="n">gaussian</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">==</span> <span class="n">spherical</span><span class="p">:</span>

                <span class="c1"># Initial guess for the parameters.</span>
                <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">),</span>                 <span class="c1"># range</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bin_means</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">bin_means</span><span class="p">),</span>  <span class="c1"># sill</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">bin_means</span><span class="p">)]</span>                      <span class="c1"># nugget</span>

                <span class="c1"># Bounds with constraints.</span>
                <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)]</span>

                <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">,</span> <span class="n">bin_centers</span><span class="p">,</span> <span class="n">bin_means</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

                    <span class="c1"># Fit variogram plot.</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">bin_means</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                <span class="n">vrange</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">sill</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">nugget</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>


                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;variogram model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variogram_func</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;range: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vrange</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sill: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sill</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nugget: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nugget</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;full sill: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sill</span> <span class="o">+</span> <span class="n">nugget</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">vrange</span><span class="p">,</span> <span class="n">sill</span><span class="p">,</span> <span class="n">nugget</span><span class="p">]</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">==</span> <span class="n">linear</span><span class="p">:</span>

                <span class="c1"># Initial guess for the parameters.</span>
                <span class="n">p0</span> <span class="o">=</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bin_means</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">bin_means</span><span class="p">)),</span>  <span class="c1"># slope</span>
                      <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">bin_means</span><span class="p">)]</span>                                                                      <span class="c1"># nugget</span>

                <span class="c1"># Bounds with constraints.</span>
                <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)]</span>

                <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">,</span> <span class="n">bin_centers</span><span class="p">,</span> <span class="n">bin_means</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

                    <span class="c1"># Fit variogram plot.</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">bin_means</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                <span class="n">slope</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">nugget</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;variogram model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variogram_func</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;slope: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slope</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nugget: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nugget</span><span class="p">))</span>


                <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">slope</span><span class="p">,</span> <span class="n">nugget</span><span class="p">]</span>


    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Use the given variogram parameters.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span> <span class="o">=</span> <span class="n">variogram_params</span>

        <span class="c1"># Apply the cutoff.</span>
        <span class="n">dist_cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">gamma_cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="c1"># Remove nans for curve_fit.</span>
        <span class="n">dist_cut</span> <span class="o">=</span> <span class="n">dist_cut</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dist_cut</span><span class="p">)]</span>
        <span class="n">gamma_cut</span> <span class="o">=</span> <span class="n">gamma_cut</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">gamma_cut</span><span class="p">)]</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>

                <span class="c1"># Calculate 2d kde to help confirm cutoff.</span>
                <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span> <span class="mi">60</span><span class="p">)</span>
                <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="mi">60</span><span class="p">)</span>
                <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
                <span class="n">xyi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">xi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">yi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

                <span class="n">kde</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">([</span><span class="n">dist</span><span class="p">,</span> <span class="n">gamma</span><span class="p">])</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">kde</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">xyi</span><span class="p">)</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">yi</span><span class="p">))</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                <span class="c1"># With cutoff and variogram model.</span>
                <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dist_cut</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dist_cut</span><span class="p">,</span> <span class="n">gamma_cut</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="c1"># Fit variogram plot.</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="n">bin_means</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\gamma(h)$&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">==</span> <span class="n">gaussian</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">==</span> <span class="n">spherical</span><span class="p">:</span>
            <span class="n">vrange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sill</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">nugget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;variogram model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variogram_func</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;range: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vrange</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sill: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sill</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nugget: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nugget</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;full sill: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sill</span> <span class="o">+</span> <span class="n">nugget</span><span class="p">))</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span> <span class="o">==</span> <span class="n">linear</span><span class="p">:</span>
            <span class="n">slope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nugget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;variogram model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variogram_func</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff_dist</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;slope: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slope</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nugget: </span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nugget</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.geostat.krige.Krige.predict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">x2_pred</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>x2</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>n-dim array
Locations to make kriging predictions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>u2_mean</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float
Kriging mean.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>u2_var</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float
Kriging variance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Performs ordinary or universal kriging using the estimated variogram parameters.</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/krige.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x2_pred</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">            x2 : n-dim array</span>
<span class="sd">                Locations to make kriging predictions.</span>

<span class="sd">    Returns:</span>
<span class="sd">            u2_mean : float</span>
<span class="sd">                Kriging mean.</span>

<span class="sd">            u2_var : float</span>
<span class="sd">                Kriging variance.</span>


<span class="sd">    Performs ordinary or universal kriging using the estimated variogram parameters.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">x2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">x2_pred</span><span class="p">)</span>

    <span class="n">n1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>
    <span class="n">n2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x2</span><span class="p">)</span>

    <span class="c1"># Universal krige.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurization</span><span class="p">:</span>            
        <span class="c1"># Ax = b with a trend.</span>

        <span class="c1"># Build A</span>
        <span class="n">D1</span> <span class="o">=</span> <span class="n">cdist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>

        <span class="n">drift_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurization</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)))</span>

        <span class="n">An</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">drift_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">An</span><span class="p">,</span> <span class="n">An</span><span class="p">))</span>
        <span class="n">A</span><span class="p">[:</span><span class="n">n1</span><span class="p">,</span> <span class="p">:</span><span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">D1</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="n">A</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="p">:</span><span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="n">A</span><span class="p">[:</span><span class="n">n1</span><span class="p">,</span> <span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="n">A</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="c1"># Add in the trend for A.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">drift_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">A</span><span class="p">[</span><span class="n">n1</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="n">drift_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">A</span><span class="p">[:</span><span class="n">n1</span><span class="p">,</span> <span class="n">n1</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">drift_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># Build b.</span>
        <span class="n">D2</span> <span class="o">=</span> <span class="n">cdist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">D2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">D2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">drift_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">b</span><span class="p">[:</span><span class="n">n2</span><span class="p">,</span> <span class="p">:</span><span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">D2</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">T</span>
        <span class="n">b</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">1.</span>

        <span class="c1"># Add the trend for b.</span>
        <span class="n">drift_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featurization</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x2</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">drift_pred</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">b</span><span class="p">[</span><span class="n">n1</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">drift_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># Solve.</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="n">u2_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tensordot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u1</span><span class="p">,</span> <span class="n">x</span><span class="p">[:</span><span class="n">n1</span><span class="p">],</span> <span class="n">axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">u2_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="o">-</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">u2_mean</span><span class="p">,</span> <span class="n">u2_var</span>


    <span class="c1"># Ordinary krige.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Ax = b.</span>

        <span class="c1"># Build A.</span>
        <span class="n">D1</span> <span class="o">=</span> <span class="n">cdist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n1</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">A</span><span class="p">[:</span><span class="n">n1</span><span class="p">,</span> <span class="p">:</span><span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">D1</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="n">A</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="n">A</span><span class="p">[:,</span> <span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="n">A</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="c1"># Build b.</span>
        <span class="n">D2</span> <span class="o">=</span> <span class="n">cdist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">D2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">D2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">b</span><span class="p">[:</span><span class="n">n2</span><span class="p">,</span> <span class="p">:</span><span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">variogram_func</span><span class="p">(</span><span class="n">D2</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_vals</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">T</span>
        <span class="n">b</span><span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">1.</span>

        <span class="c1"># Solve.</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="n">u2_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tensordot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u1</span><span class="p">,</span> <span class="n">x</span><span class="p">[:</span><span class="n">n1</span><span class="p">],</span> <span class="n">axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">u2_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="o">-</span><span class="n">b</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">u2_mean</span><span class="p">,</span> <span class="n">u2_var</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="src.geostat.krige.cutoff_dist_func" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cutoff_dist_func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>x</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>n-dim array
Locations of input data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>cutoff</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>float
The maximum lag distance to use in fitting the variogram.
Found using Pythagorean Theorem to roughly find one half the distance across the study area.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/geostat/krige.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cutoff_dist_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters:</span>
<span class="sd">                x : n-dim array</span>
<span class="sd">                    Locations of input data.</span>

<span class="sd">        Returns:</span>
<span class="sd">                cutoff : float</span>
<span class="sd">                    The maximum lag distance to use in fitting the variogram.</span>
<span class="sd">                    Found using Pythagorean Theorem to roughly find one half the distance across the study area.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>

    <span class="n">cutoff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a2</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">return</span> <span class="n">cutoff</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />


<div class="doc doc-object doc-module">



<h2 id="src.geostat.mean" class="doc doc-heading">
            <code>src.geostat.mean</code>


</h2>

    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="src.geostat.mean.Mean" class="doc doc-heading">
            <code>Mean</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.geostat.op.Op" href="#src.geostat.op.Op">Op</a></code></p>


              <details class="quote">
                <summary>Source code in <code>src/geostat/mean.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Mean</span><span class="p">(</span><span class="n">Op</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fa</span><span class="p">,</span> <span class="n">autoinputs</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;locs1&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">autoinputs</span><span class="p">:</span> <span class="n">autoinputs</span><span class="p">[</span><span class="s1">&#39;locs1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;locs1&#39;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span> <span class="n">autoinputs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ZeroTrend</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ZeroTrend</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Stack</span><span class="p">([</span><span class="bp">self</span><span class="p">])</span> <span class="o">+</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns tuple `(mean, covariance)` for locations.</span>
<span class="sd">        Return values have correct shapes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">M</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">M</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;locs1&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="p">[</span><span class="n">n1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">M</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.geostat.mean.Mean.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Returns tuple <code>(mean, covariance)</code> for locations.
Return values have correct shapes.</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/mean.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns tuple `(mean, covariance)` for locations.</span>
<span class="sd">    Return values have correct shapes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">M</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">M</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;locs1&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="p">[</span><span class="n">n1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">M</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><hr />


<div class="doc doc-object doc-module">



<h2 id="src.geostat.mesh" class="doc doc-heading">
            <code>src.geostat.mesh</code>


</h2>

    <div class="doc doc-contents first">



  <div class="doc doc-children">











  </div>

    </div>

</div><hr />


<div class="doc doc-object doc-module">



<h2 id="src.geostat.metric" class="doc doc-heading">
            <code>src.geostat.metric</code>


</h2>

    <div class="doc doc-contents first">



  <div class="doc doc-children">











  </div>

    </div>

</div><hr />


<div class="doc doc-object doc-module">



<h2 id="src.geostat.model" class="doc doc-heading">
            <code>src.geostat.model</code>


</h2>

    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="src.geostat.model.Featurizer" class="doc doc-heading">
            <code>Featurizer</code>


</h3>


    <div class="doc doc-contents ">


      <p>Featurizer class for producing feature matrices (F matrix) from location data.</p>
<p>The <code>Featurizer</code> applies a specified featurization function to the input location data 
and generates the corresponding feature matrix. If no featurization function is provided, 
it produces a matrix with appropriate dimensions containing only ones.</p>
<h5 id="src.geostat.model.Featurizer--parameters">Parameters</h5>
<ul>
<li>featurization : Callable or None
    A function that takes in the individual components of location data and returns the features.
    If set to <code>None</code>, the featurizer will produce an empty feature matrix (i.e., only ones).</li>
</ul>
<h5 id="src.geostat.model.Featurizer--examples">Examples</h5>
<p>Creating a <code>Featurizer</code> using a custom featurization function:</p>
<pre><code>import tensorflow as tf
from geostat.model import Featurizer

# Define a custom featurization function
def simple_featurizer(x, y):
    return x, y, x * y

# Initialize the Featurizer
featurizer = Featurizer(simple_featurizer)
</code></pre>
<p>Using the <code>Featurizer</code> to transform location data:</p>
<pre><code>locs = tf.constant([[1.0, 2.0], [3.0, 4.0], [5.0, 6.0]])
F_matrix = featurizer(locs)
# F_matrix will contain the features: (x, y, x*y) for each location
</code></pre>
<p>Handling the case where no featurization is provided:</p>
<pre><code>featurizer_no_feat = Featurizer(None)
F_matrix = featurizer_no_feat(locs)
# Since no featurization function is provided, F_matrix will have shape (3, 0)
</code></pre>
<h5 id="src.geostat.model.Featurizer--notes">Notes</h5>
<ul>
<li>The <code>__call__</code> method is used to apply the featurization to input location data.</li>
<li>If <code>featurization</code> returns a tuple, it is assumed to represent multiple features, 
  which will be stacked to form the feature matrix.</li>
</ul>

              <details class="quote">
                <summary>Source code in <code>src/geostat/model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Featurizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Featurizer class for producing feature matrices (F matrix) from location data.</span>

<span class="sd">    The `Featurizer` applies a specified featurization function to the input location data </span>
<span class="sd">    and generates the corresponding feature matrix. If no featurization function is provided, </span>
<span class="sd">    it produces a matrix with appropriate dimensions containing only ones.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    * featurization : Callable or None</span>
<span class="sd">        A function that takes in the individual components of location data and returns the features.</span>
<span class="sd">        If set to `None`, the featurizer will produce an empty feature matrix (i.e., only ones).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Creating a `Featurizer` using a custom featurization function:</span>

<span class="sd">    ```</span>
<span class="sd">    import tensorflow as tf</span>
<span class="sd">    from geostat.model import Featurizer</span>

<span class="sd">    # Define a custom featurization function</span>
<span class="sd">    def simple_featurizer(x, y):</span>
<span class="sd">        return x, y, x * y</span>

<span class="sd">    # Initialize the Featurizer</span>
<span class="sd">    featurizer = Featurizer(simple_featurizer)</span>
<span class="sd">    ```</span>

<span class="sd">    Using the `Featurizer` to transform location data:</span>

<span class="sd">    ```</span>
<span class="sd">    locs = tf.constant([[1.0, 2.0], [3.0, 4.0], [5.0, 6.0]])</span>
<span class="sd">    F_matrix = featurizer(locs)</span>
<span class="sd">    # F_matrix will contain the features: (x, y, x*y) for each location</span>
<span class="sd">    ```</span>

<span class="sd">    Handling the case where no featurization is provided:</span>

<span class="sd">    ```</span>
<span class="sd">    featurizer_no_feat = Featurizer(None)</span>
<span class="sd">    F_matrix = featurizer_no_feat(locs)</span>
<span class="sd">    # Since no featurization function is provided, F_matrix will have shape (3, 0)</span>
<span class="sd">    ```</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The `__call__` method is used to apply the featurization to input location data.</span>
<span class="sd">    - If `featurization` returns a tuple, it is assumed to represent multiple features, </span>
<span class="sd">      which will be stacked to form the feature matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">featurization</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featurization</span> <span class="o">=</span> <span class="n">featurization</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locs</span><span class="p">):</span>
        <span class="n">locs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">locs</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurization</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># No features.</span>
            <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">locs</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="n">feats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurization</span><span class="p">(</span><span class="o">*</span><span class="n">tf</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">locs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span> <span class="c1"># One or many features.</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">feats</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">locs</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">feats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurization</span><span class="p">(</span><span class="o">*</span><span class="n">tf</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">locs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">feats</span> <span class="o">=</span> <span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">locs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">feats</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># One feature.</span>
            <span class="k">return</span> <span class="n">e</span><span class="p">(</span><span class="n">feats</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="src.geostat.model.GP" class="doc doc-heading">
            <code>GP</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">


      <p>Gaussian Process (GP) model class with a mean function and a kernel.</p>
<p>This class represents a Gaussian Process with specified mean and kernel functions.
If no mean is provided, a zero mean is used by default. The kernel must always be specified.
The class supports addition to combine two GP models, and it allows gathering variables 
from the mean and kernel.</p>
<h5 id="src.geostat.model.GP--parameters">Parameters</h5>
<ul>
<li>mean : mn.Trend, optional
    The mean function of the Gaussian Process. If not provided or set to 0, 
    a ZeroTrend is used as the default mean.</li>
<li>kernel : krn.Kernel
    The kernel function of the Gaussian Process. This parameter is required.</li>
</ul>
<h5 id="src.geostat.model.GP--examples">Examples</h5>
<p>Creating a simple Gaussian Process with default mean and a Noise kernel:</p>
<pre><code>import geostat.mean as mn
import geostat.kernel as krn
from geostat import Parameters, GP
p = Parameters(nugget=1., sill=1., beta=[4., 3., 2., 1.])
kernel = krn.Noise(p.nugget)
gp = GP(kernel=kernel)
</code></pre>
<p>The mean defaults to ZeroTrend if not provided.</p>
<pre><code>gp.mean
</code></pre>
<p><ZeroTrend object></p>
<p>Specifying both mean and kernel:</p>
<pre><code>@geostat.featurizer()
def trend_featurizer(x, y): return 1., x, y, x*y
mean_function = mn.Trend(trend_featurizer, beta=p.beta)
gp = GP(mean=mean_function, kernel=kernel)
</code></pre>
<p>Adding two GP objects:</p>
<pre><code>gp1 = GP(kernel=krn.Noise(p.nugget))
gp2 = GP(mean=mean_function, kernel=krn.Delta(p.sill))
combined_gp = gp1 + gp2
combined_gp.mean  # &lt;ZeroTrend + Trend object&gt;
combined_gp.kernel  # &lt;Noise + Delta object&gt;
</code></pre>
<h5 id="src.geostat.model.GP--notes">Notes</h5>
<ul>
<li>The <code>__tf_tracing_type__</code> method is used for TensorFlow tracing purposes and typically not called directly.</li>
<li>Ensure that the kernel is always provided upon initialization.</li>
</ul>

              <details class="quote">
                <summary>Source code in <code>src/geostat/model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">GP</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gaussian Process (GP) model class with a mean function and a kernel.</span>

<span class="sd">    This class represents a Gaussian Process with specified mean and kernel functions.</span>
<span class="sd">    If no mean is provided, a zero mean is used by default. The kernel must always be specified.</span>
<span class="sd">    The class supports addition to combine two GP models, and it allows gathering variables </span>
<span class="sd">    from the mean and kernel.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    * mean : mn.Trend, optional</span>
<span class="sd">        The mean function of the Gaussian Process. If not provided or set to 0, </span>
<span class="sd">        a ZeroTrend is used as the default mean.</span>
<span class="sd">    * kernel : krn.Kernel</span>
<span class="sd">        The kernel function of the Gaussian Process. This parameter is required.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Creating a simple Gaussian Process with default mean and a Noise kernel:</span>

<span class="sd">    ```</span>
<span class="sd">    import geostat.mean as mn</span>
<span class="sd">    import geostat.kernel as krn</span>
<span class="sd">    from geostat import Parameters, GP</span>
<span class="sd">    p = Parameters(nugget=1., sill=1., beta=[4., 3., 2., 1.])</span>
<span class="sd">    kernel = krn.Noise(p.nugget)</span>
<span class="sd">    gp = GP(kernel=kernel)</span>
<span class="sd">    ```</span>

<span class="sd">    The mean defaults to ZeroTrend if not provided.</span>

<span class="sd">    ```</span>
<span class="sd">    gp.mean</span>
<span class="sd">    ```</span>
<span class="sd">    &lt;ZeroTrend object&gt;</span>

<span class="sd">    Specifying both mean and kernel:</span>

<span class="sd">    ```</span>
<span class="sd">    @geostat.featurizer()</span>
<span class="sd">    def trend_featurizer(x, y): return 1., x, y, x*y</span>
<span class="sd">    mean_function = mn.Trend(trend_featurizer, beta=p.beta)</span>
<span class="sd">    gp = GP(mean=mean_function, kernel=kernel)</span>
<span class="sd">    ```</span>

<span class="sd">    Adding two GP objects:</span>

<span class="sd">    ```</span>
<span class="sd">    gp1 = GP(kernel=krn.Noise(p.nugget))</span>
<span class="sd">    gp2 = GP(mean=mean_function, kernel=krn.Delta(p.sill))</span>
<span class="sd">    combined_gp = gp1 + gp2</span>
<span class="sd">    combined_gp.mean  # &lt;ZeroTrend + Trend object&gt;</span>
<span class="sd">    combined_gp.kernel  # &lt;Noise + Delta object&gt;</span>
<span class="sd">    ```</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The `__tf_tracing_type__` method is used for TensorFlow tracing purposes and typically not called directly.</span>
<span class="sd">    - Ensure that the kernel is always provided upon initialization.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mean</span><span class="p">:</span> <span class="n">mn</span><span class="o">.</span><span class="n">Trend</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">kernel</span><span class="p">:</span> <span class="n">krn</span><span class="o">.</span><span class="n">Kernel</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="n">mn</span><span class="o">.</span><span class="n">ZeroTrend</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GP</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">kernel</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__tf_tracing_type__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SingletonTraceType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">gather_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">gather_vars</span><span class="p">()</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">gather_vars</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="src.geostat.model.Model" class="doc doc-heading">
            <code>Model</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">


      <p>Model class for performing Gaussian Process (GP) training and prediction with optional warping.</p>
<p>The <code>Model</code> class integrates a GP model with optional data warping, and supports data generation on given location,
training on given location and observation data, and prediction on given location.</p>
<h5 id="src.geostat.model.Model--parameters">Parameters</h5>
<ul>
<li>gp : GP
    The Gaussian Process model to be used for training and prediction.</li>
<li>warp : Warp, optional
    An optional warping transformation applied to the data. If not specified, <code>NoWarp</code> 
    is used by default.</li>
<li>parameter_sample_size : int, optional
    The number of parameter samples to draw. Default is None.</li>
<li>locs : np.ndarray, optional
    A NumPy array containing location data.</li>
<li>vals : np.ndarray, optional
    A NumPy array containing observed values corresponding to <code>locs</code>.</li>
<li>cats : np.ndarray, optional
    A NumPy array containing categorical data.</li>
<li>report : Callable, optional
    A custom reporting function to display model parameters. If not provided, a default 
    reporting function is used.</li>
<li>verbose : bool, default=True
    Whether to print model parameters and status updates.</li>
</ul>
<h5 id="src.geostat.model.Model--examples">Examples</h5>
<p>Initializing a <code>Model</code> with a Gaussian Process:</p>
<pre><code>from geostat import GP, Model
from geostat.kernel import Noise
import numpy as np

gp = GP(kernel=Noise(1.0))
locs = np.array([[0.0, 1.0], [1.0, 2.0]])
vals = np.array([1.0, 2.0])
model = Model(gp=gp, locs=locs, vals=vals)
</code></pre>
<h5 id="src.geostat.model.Model--notes">Notes</h5>
<ul>
<li>The <code>__post_init__</code> method sets up default values, initializes the warping if not provided, 
  and sets up reporting and data preprocessing.</li>
</ul>

              <details class="quote">
                <summary>Source code in <code>src/geostat/model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Model</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model class for performing Gaussian Process (GP) training and prediction with optional warping.</span>

<span class="sd">    The `Model` class integrates a GP model with optional data warping, and supports data generation on given location,</span>
<span class="sd">    training on given location and observation data, and prediction on given location.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    * gp : GP</span>
<span class="sd">        The Gaussian Process model to be used for training and prediction.</span>
<span class="sd">    * warp : Warp, optional</span>
<span class="sd">        An optional warping transformation applied to the data. If not specified, `NoWarp` </span>
<span class="sd">        is used by default.</span>
<span class="sd">    * parameter_sample_size : int, optional</span>
<span class="sd">        The number of parameter samples to draw. Default is None.</span>
<span class="sd">    * locs : np.ndarray, optional</span>
<span class="sd">        A NumPy array containing location data.</span>
<span class="sd">    * vals : np.ndarray, optional</span>
<span class="sd">        A NumPy array containing observed values corresponding to `locs`.</span>
<span class="sd">    * cats : np.ndarray, optional</span>
<span class="sd">        A NumPy array containing categorical data.</span>
<span class="sd">    * report : Callable, optional</span>
<span class="sd">        A custom reporting function to display model parameters. If not provided, a default </span>
<span class="sd">        reporting function is used.</span>
<span class="sd">    * verbose : bool, default=True</span>
<span class="sd">        Whether to print model parameters and status updates.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Initializing a `Model` with a Gaussian Process:</span>

<span class="sd">    ```</span>
<span class="sd">    from geostat import GP, Model</span>
<span class="sd">    from geostat.kernel import Noise</span>
<span class="sd">    import numpy as np</span>

<span class="sd">    gp = GP(kernel=Noise(1.0))</span>
<span class="sd">    locs = np.array([[0.0, 1.0], [1.0, 2.0]])</span>
<span class="sd">    vals = np.array([1.0, 2.0])</span>
<span class="sd">    model = Model(gp=gp, locs=locs, vals=vals)</span>
<span class="sd">    ```</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The `__post_init__` method sets up default values, initializes the warping if not provided, </span>
<span class="sd">      and sets up reporting and data preprocessing.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gp</span><span class="p">:</span> <span class="n">GP</span>
    <span class="n">warp</span><span class="p">:</span> <span class="n">Warp</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">parameter_sample_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">locs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">vals</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cats</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">report</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># &#39;&#39;&#39;</span>
        <span class="c1"># Parameters:</span>
        <span class="c1">#         x : Pandas DataFrame with columns for locations.</span>

        <span class="c1">#         u : A Pandas Series containing observations.</span>

        <span class="c1">#         featurization : function, optional</span>
        <span class="c1">#             Should be a function that takes x1 (n-dim array of input data)</span>
        <span class="c1">#             and returns the coordinates, i.e., x, y, x**2, y**2.</span>
        <span class="c1">#             Example: def featurization(x1):</span>
        <span class="c1">#                         return x1[:, 0], x1[:, 1], x1[:, 0]**2, x1[:, 1]**2.</span>
        <span class="c1">#             Default is None.</span>

        <span class="c1">#         latent : List[GP]</span>
        <span class="c1">#              Name of the covariance function to use in the GP.</span>
        <span class="c1">#              Should be &#39;squared-exp&#39; or &#39;gamma-exp&#39;.</span>
        <span class="c1">#              Default is &#39;squared-exp&#39;.</span>

        <span class="c1">#         verbose : boolean, optional</span>
        <span class="c1">#             Whether or not to print parameters.</span>
        <span class="c1">#             Default is True.</span>

        <span class="c1"># Performs Gaussian process training and prediction.</span>
        <span class="c1"># &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">warp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">warp</span> <span class="o">=</span> <span class="n">NoWarp</span><span class="p">()</span>

        <span class="c1"># Default reporting function.</span>
        <span class="k">def</span> <span class="nf">default_report</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">fmt</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)):</span>
                    <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{:5d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)):</span>
                    <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{:5.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;floatkind&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:5.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">}):</span>
                        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">fmt</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">())))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">report</span> <span class="o">=</span> <span class="n">default_report</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">locs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vals</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cats</span><span class="p">)</span>

        <span class="c1"># Collect parameters and create TF parameters.</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gather_vars</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">p</span><span class="o">.</span><span class="n">create_tf_variable</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">gather_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="o">.</span><span class="n">gather_vars</span><span class="p">()</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">warp</span><span class="o">.</span><span class="n">gather_vars</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set(**values)</span>

<span class="sd">        Sets the values of the model&#39;s parameters based on the provided keyword arguments.</span>
<span class="sd">        Each parameter specified must exist in the model; otherwise, a `ValueError` is raised.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        * values : keyword arguments</span>
<span class="sd">            A dictionary of parameter names and their corresponding values that should be </span>
<span class="sd">            set in the model. Each key corresponds to a parameter name, and the value is </span>
<span class="sd">            the value to be assigned to that parameter.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        * self : Model</span>
<span class="sd">            The model instance with updated parameter values, allowing for method chaining.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        * ValueError</span>
<span class="sd">            If a provided parameter name does not exist in the model&#39;s parameters.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Update parameter value using `set`:</span>

<span class="sd">        ```</span>
<span class="sd">        from geostat import GP, Model</span>
<span class="sd">        from geostat.kernel import Noise</span>

<span class="sd">        # Create model</span>
<span class="sd">        kernel = Noise(nugget=1.0)</span>
<span class="sd">        model = Model(GP(0, kernel))</span>

<span class="sd">        # Update parameters</span>
<span class="sd">        model.set(nugget=0.5)</span>
<span class="sd">        ```</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - The `set` method retrieves the current parameters using `gather_vars` and updates </span>
<span class="sd">        their values. The associated TensorFlow variables are also recreated.</span>
<span class="sd">        - This method is useful for dynamically updating the model&#39;s parameters after initialization.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gather_vars</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
                <span class="n">parameters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">v</span>
                <span class="n">parameters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">create_tf_variable</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> is not a parameter&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locs</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">cats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">iters</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">reg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        fit(locs, vals, cats=None, step_size=0.01, iters=100, reg=None)</span>

<span class="sd">        Trains the model using the provided location and value data by optimizing the parameters of the Gaussian Process (GP)</span>
<span class="sd">        using the Adam optimizer. Optionally performs regularization and can handle categorical data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        * locs : np.ndarray</span>
<span class="sd">            A NumPy array containing the input locations for training.</span>
<span class="sd">        * vals : np.ndarray</span>
<span class="sd">            A NumPy array containing observed values corresponding to the `locs`.</span>
<span class="sd">        * cats : np.ndarray, optional</span>
<span class="sd">            A NumPy array containing categorical data for each observation in `locs`. If provided,</span>
<span class="sd">            the data is sorted according to `cats` to enable stratified training. Defaults to None.</span>
<span class="sd">        * step_size : float, default=0.01</span>
<span class="sd">            The learning rate for the Adam optimizer.</span>
<span class="sd">        * iters : int, default=100</span>
<span class="sd">            The total number of iterations to run for training.</span>
<span class="sd">        * reg : float or None, optional</span>
<span class="sd">            Regularization penalty parameter. If None, no regularization is applied.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        * self : Model</span>
<span class="sd">            The model instance with updated parameters, allowing for method chaining.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Fitting a model using training data:</span>

<span class="sd">        ```</span>
<span class="sd">        from geostat import GP, Model</span>
<span class="sd">        from geostat.kernel import Noise</span>

<span class="sd">        # Create model</span>
<span class="sd">        kernel = Noise(nugget=1.0)</span>
<span class="sd">        model = Model(GP(0, kernel))</span>

<span class="sd">        # Fit model</span>
<span class="sd">        locs = np.array([[1.0, 2.0], [2.0, 3.0], [3.0, 4.0]])</span>
<span class="sd">        vals = np.array([10.0, 15.0, 20.0])</span>
<span class="sd">        model.fit(locs, vals, step_size=0.05, iters=500)</span>
<span class="sd">        ```</span>

<span class="sd">        Using categorical data for training:</span>

<span class="sd">        ```</span>
<span class="sd">        cats = np.array([1, 1, 2])</span>
<span class="sd">        model.fit(locs, vals, cats=cats, step_size=0.01, iters=300)</span>
<span class="sd">        ```</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - The `fit` method uses the Adam optimizer to minimize the negative log-likelihood (`ll`) and any regularization </span>
<span class="sd">        penalties specified by `reg`.</span>
<span class="sd">        - During training, if `cats` are provided, data points are sorted according to `cats` to ensure grouped training.</span>
<span class="sd">        - The `verbose` flag determines whether training progress is printed after each iteration.</span>
<span class="sd">        - After training, parameter values are saved and can be accessed or updated using the model&#39;s attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Collect parameters and create TF parameters.</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gather_vars</span><span class="p">()</span>

        <span class="c1"># Permute datapoints if cats is given.</span>
        <span class="k">if</span> <span class="n">cats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span>
            <span class="n">perm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span>
            <span class="n">locs</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">cats</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="n">perm</span><span class="p">],</span> <span class="n">vals</span><span class="p">[</span><span class="n">perm</span><span class="p">],</span> <span class="n">cats</span><span class="p">[</span><span class="n">perm</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">locs</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="n">perm</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Data dict.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;warplocs&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">warp</span><span class="p">(</span><span class="n">locs</span><span class="p">),</span>
            <span class="s1">&#39;vals&#39;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
            <span class="s1">&#39;cats&#39;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)}</span>

        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="n">step_size</span><span class="p">)</span>

        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Iteration count.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">iters</span> <span class="o">/</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">ll</span><span class="p">,</span> <span class="n">reg_penalty</span> <span class="o">=</span> <span class="n">gp_train_step</span><span class="p">(</span>
                    <span class="n">optimizer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span> <span class="n">reg</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">time_elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span>
                  <span class="nb">dict</span><span class="p">(</span><span class="nb">iter</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">ll</span><span class="o">=</span><span class="n">ll</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time_elapsed</span><span class="p">,</span> <span class="n">reg</span><span class="o">=</span><span class="n">reg_penalty</span><span class="p">)</span> <span class="o">|</span>
                  <span class="p">{</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">surface</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">()})</span>

        <span class="c1"># Save parameter values.</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">p</span><span class="o">.</span><span class="n">update_value</span><span class="p">()</span>

        <span class="c1"># Restore order if things were permuted.</span>
        <span class="k">if</span> <span class="n">perm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">revperm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>
            <span class="n">locs</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">cats</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="n">revperm</span><span class="p">],</span> <span class="n">vals</span><span class="p">[</span><span class="n">revperm</span><span class="p">],</span> <span class="n">cats</span><span class="p">[</span><span class="n">revperm</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">locs</span> <span class="o">=</span> <span class="n">locs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cats</span> <span class="o">=</span> <span class="n">cats</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">mcmc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locs</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">cats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">move_prob</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">burnin</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">report_interval</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>

        <span class="k">assert</span> <span class="n">samples</span> <span class="o">%</span> <span class="n">report_interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;`samples` must be a multiple of `report_interval`&#39;</span>
        <span class="k">assert</span> <span class="n">burnin</span> <span class="o">%</span> <span class="n">report_interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;`burnin` must be a multiple of `report_interval`&#39;</span>

        <span class="c1"># Permute datapoints if cats is given.</span>
        <span class="k">if</span> <span class="n">cats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span>
            <span class="n">perm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span>
            <span class="n">locs</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">cats</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="n">perm</span><span class="p">],</span> <span class="n">vals</span><span class="p">[</span><span class="n">perm</span><span class="p">],</span> <span class="n">cats</span><span class="p">[</span><span class="n">perm</span><span class="p">]</span>

        <span class="c1"># Data dict.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;locs&#39;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
            <span class="s1">&#39;vals&#39;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
            <span class="s1">&#39;cats&#39;</span><span class="p">:</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">cats</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)}</span>

        <span class="c1"># Initial MCMC state.</span>
        <span class="n">initial_up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_space</span><span class="o">.</span><span class="n">get_underlying</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

        <span class="c1"># Unnormalized log posterior distribution.</span>
        <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">up</span><span class="p">):</span>
            <span class="n">sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_space</span><span class="o">.</span><span class="n">get_surface</span><span class="p">(</span><span class="n">up</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">gp_log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">sp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="o">*</span><span class="n">up_flat</span><span class="p">):</span>
            <span class="n">up</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">pack_sequence_as</span><span class="p">(</span><span class="n">initial_up</span><span class="p">,</span> <span class="n">up_flat</span><span class="p">)</span>
            <span class="n">ll</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">map_fn</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">up</span><span class="p">,</span> <span class="n">fn_output_signature</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="c1"># log_prior = -tf.reduce_sum(tf.math.log(1. + tf.square(up_flat)), axis=0)</span>
            <span class="k">return</span> <span class="n">ll</span> <span class="c1"># + log_prior</span>

        <span class="c1"># Run the chain for a burst.</span>
        <span class="nd">@tf</span><span class="o">.</span><span class="n">function</span>
        <span class="k">def</span> <span class="nf">run_chain</span><span class="p">(</span><span class="n">current_state</span><span class="p">,</span> <span class="n">final_results</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">iters</span><span class="p">):</span>
            <span class="n">samples</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">final_results</span> <span class="o">=</span> <span class="n">tfp</span><span class="o">.</span><span class="n">mcmc</span><span class="o">.</span><span class="n">sample_chain</span><span class="p">(</span>
                <span class="n">num_results</span><span class="o">=</span><span class="n">iters</span><span class="p">,</span>
                <span class="n">current_state</span><span class="o">=</span><span class="n">current_state</span><span class="p">,</span>
                <span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span>
                <span class="n">return_final_kernel_results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">trace_fn</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="n">results</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">samples</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">final_results</span>

        <span class="k">def</span> <span class="nf">new_state_fn</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
          <span class="n">direction_dist</span> <span class="o">=</span> <span class="n">tfd</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
          <span class="n">scale_dist</span> <span class="o">=</span> <span class="n">tfd</span><span class="o">.</span><span class="n">Exponential</span><span class="p">(</span><span class="n">rate</span><span class="o">=</span><span class="n">dtype</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">scale</span><span class="p">))</span>
          <span class="n">pick_dist</span> <span class="o">=</span> <span class="n">tfd</span><span class="o">.</span><span class="n">Bernoulli</span><span class="p">(</span><span class="n">probs</span><span class="o">=</span><span class="n">move_prob</span><span class="p">)</span>

          <span class="k">def</span> <span class="nf">_fn</span><span class="p">(</span><span class="n">state_parts</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
            <span class="n">next_state_parts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">part_seeds</span> <span class="o">=</span> <span class="n">tfp</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split_seed</span><span class="p">(</span>
                <span class="n">seed</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">state_parts</span><span class="p">),</span> <span class="n">salt</span><span class="o">=</span><span class="s1">&#39;rwmcauchy&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">ps</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">state_parts</span><span class="p">,</span> <span class="n">part_seeds</span><span class="p">):</span>
                <span class="n">pick</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">pick_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">sample_shape</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">ps</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
                <span class="n">direction</span> <span class="o">=</span> <span class="n">direction_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">sample_shape</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">ps</span><span class="p">)</span>
                <span class="n">scale_val</span> <span class="o">=</span> <span class="n">scale_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">ps</span><span class="p">)</span>
                <span class="n">next_state_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;a...,a-&gt;a...&#39;</span><span class="p">,</span> <span class="n">pick</span> <span class="o">*</span> <span class="n">direction</span><span class="p">,</span> <span class="n">scale_val</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">next_state_parts</span>
          <span class="k">return</span> <span class="n">_fn</span>

        <span class="n">inv_temps</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">chains</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">make_kernel_fn</span><span class="p">(</span><span class="n">target_log_prob_fn</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">tfp</span><span class="o">.</span><span class="n">mcmc</span><span class="o">.</span><span class="n">RandomWalkMetropolis</span><span class="p">(</span>
                <span class="n">target_log_prob_fn</span><span class="o">=</span><span class="n">target_log_prob_fn</span><span class="p">,</span>
                <span class="n">new_state_fn</span><span class="o">=</span><span class="n">new_state_fn</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="n">step_size</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">inv_temps</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>

        <span class="n">kernel</span> <span class="o">=</span> <span class="n">tfp</span><span class="o">.</span><span class="n">mcmc</span><span class="o">.</span><span class="n">ReplicaExchangeMC</span><span class="p">(</span>
            <span class="n">target_log_prob_fn</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
            <span class="n">inverse_temperatures</span><span class="o">=</span><span class="n">inv_temps</span><span class="p">,</span>
            <span class="n">make_kernel_fn</span><span class="o">=</span><span class="n">make_kernel_fn</span><span class="p">)</span>

        <span class="c1"># Do bursts.</span>
        <span class="n">current_state</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">initial_up</span><span class="p">)</span>
        <span class="n">final_results</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">acc_states</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">num_bursts</span> <span class="o">=</span> <span class="p">(</span><span class="n">samples</span> <span class="o">+</span> <span class="n">burnin</span><span class="p">)</span> <span class="o">//</span> <span class="n">report_interval</span>
        <span class="n">burnin_bursts</span> <span class="o">=</span> <span class="n">burnin</span> <span class="o">//</span> <span class="n">report_interval</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bursts</span><span class="p">):</span>
            <span class="n">is_burnin</span> <span class="o">=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">burnin_bursts</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="n">burnin_bursts</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;BURNIN</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">is_burnin</span> <span class="k">else</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SAMPLING&#39;</span><span class="p">)</span>

            <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">states</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">final_results</span> <span class="o">=</span> <span class="n">run_chain</span><span class="p">(</span><span class="n">current_state</span><span class="p">,</span> <span class="n">final_results</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">report_interval</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_burnin</span><span class="p">:</span> <span class="nb">print</span><span class="p">()</span>
                <span class="n">accept_rates</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">post_swap_replica_results</span><span class="o">.</span><span class="n">is_accepted</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[iter </span><span class="si">{:4d}</span><span class="s1">] [time </span><span class="si">{:.1f}</span><span class="s1">] [accept rates </span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="p">((</span><span class="n">i</span> <span class="k">if</span> <span class="n">is_burnin</span> <span class="k">else</span> <span class="n">i</span> <span class="o">-</span> <span class="n">burnin_bursts</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">report_interval</span><span class="p">,</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span>
                    <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">accept_rates</span><span class="o">.</span><span class="n">tolist</span><span class="p">()])))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_burnin</span><span class="p">:</span>
                <span class="n">acc_states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">map_structure</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">states</span><span class="p">))</span>
                <span class="n">all_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">acc_states</span><span class="p">)]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">pack_sequence_as</span><span class="p">(</span><span class="n">initial_up</span><span class="p">,</span> <span class="n">all_states</span><span class="p">)</span>
                <span class="n">sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_space</span><span class="o">.</span><span class="n">get_surface</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="n">numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 

                <span class="c1"># Reporting</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">95</span><span class="p">]:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">map_structure</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">sp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s1">02d</span><span class="si">}</span><span class="s1">%ile&#39;</span><span class="p">)</span>

            <span class="n">current_state</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">states</span><span class="p">]</span>

        <span class="n">posterior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_space</span><span class="o">.</span><span class="n">get_surface</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="n">numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Restore order if things were permuted.</span>
        <span class="k">if</span> <span class="n">cats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">revperm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>
            <span class="n">locs</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">cats</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="n">revperm</span><span class="p">],</span> <span class="n">vals</span><span class="p">[</span><span class="n">revperm</span><span class="p">],</span> <span class="n">cats</span><span class="p">[</span><span class="n">revperm</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
            <span class="n">parameters</span><span class="o">=</span><span class="n">posterior</span><span class="p">,</span>
            <span class="n">parameter_sample_size</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span>
            <span class="n">locs</span><span class="o">=</span><span class="n">locs</span><span class="p">,</span> <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="p">,</span> <span class="n">cats</span><span class="o">=</span><span class="n">cats</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locs</span><span class="p">,</span> <span class="n">cats</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generate(locs, cats=None)</span>

<span class="sd">        Generates synthetic data values from the Gaussian Process (GP) model based on the provided location data.</span>
<span class="sd">        This method simulates values based on the GP&#39;s covariance structure, allowing for random sample generation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        * locs : np.ndarray</span>
<span class="sd">            A NumPy array containing the input locations for which to generate synthetic values.</span>
<span class="sd">        * cats : np.ndarray, optional</span>
<span class="sd">            A NumPy array containing categorical data corresponding to `locs`. If provided, data points </span>
<span class="sd">            are permuted according to `cats` for stratified generation. Defaults to None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        * self : Model</span>
<span class="sd">            The model instance with generated values stored in `self.vals` and corresponding locations stored </span>
<span class="sd">            in `self.locs`. This enables method chaining.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Generating synthetic values for a set of locations:</span>

<span class="sd">        ```</span>
<span class="sd">        from geostat import GP, Model</span>
<span class="sd">        from geostat.kernel import Noise</span>

<span class="sd">        # Create model</span>
<span class="sd">        kernel = Noise(nugget=1.0)</span>
<span class="sd">        model = Model(GP(0, kernel))</span>

<span class="sd">        # Generate values based on locs</span>
<span class="sd">        locs = np.array([[1.0, 2.0], [3.0, 4.0], [5.0, 6.0]])</span>
<span class="sd">        model.generate(locs)</span>
<span class="sd">        generated_vals = model.vals  # Access the generated values</span>
<span class="sd">        ```</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - Conditional generation is currently not supported, and this method will raise an assertion error if </span>
<span class="sd">        `self.locs` and `self.vals` are already defined.</span>
<span class="sd">        - Generation from a distribution is not yet supported, and an assertion error will be raised if </span>
<span class="sd">        `self.parameter_sample_size` is not `None`.</span>
<span class="sd">        - If `cats` are provided, the data is permuted according to `cats` for stratified generation, and </span>
<span class="sd">        the original order is restored before returning.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">locs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Conditional generation not yet supported&#39;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_sample_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Generation from a distribution not yet supported&#39;</span>

        <span class="n">locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span>

        <span class="c1"># Permute datapoints if cats is given.</span>
        <span class="k">if</span> <span class="n">cats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span>
            <span class="n">perm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span>
            <span class="n">locs</span><span class="p">,</span> <span class="n">cats</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="n">perm</span><span class="p">],</span> <span class="n">cats</span><span class="p">[</span><span class="n">perm</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">locs</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="n">perm</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">m</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="n">gp_covariance</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warp</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">({}),</span>
            <span class="kc">None</span> <span class="k">if</span> <span class="n">cats</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>

        <span class="n">vals</span> <span class="o">=</span> <span class="n">MVN</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cholesky</span><span class="p">(</span><span class="n">S</span><span class="p">))</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

        <span class="c1"># Restore order if things were permuted.</span>
        <span class="k">if</span> <span class="n">perm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">revperm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>
            <span class="n">locs</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">cats</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="n">revperm</span><span class="p">],</span> <span class="n">vals</span><span class="p">[</span><span class="n">revperm</span><span class="p">],</span> <span class="n">cats</span><span class="p">[</span><span class="n">revperm</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">locs</span> <span class="o">=</span> <span class="n">locs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cats</span> <span class="o">=</span> <span class="n">cats</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">subsample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reduce</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tracker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pair</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        predict(locs2, cats2=None, *, subsample=None, reduce=None, tracker=None, pair=False)</span>

<span class="sd">        Performs Gaussian Process (GP) predictions of the mean and variance for the given location data.</span>
<span class="sd">        Supports batch predictions for large datasets and can handle categorical data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        * locs2 : np.ndarray</span>
<span class="sd">            A NumPy array containing the input locations for which predictions are to be made.</span>
<span class="sd">        * cats2 : np.ndarray, optional</span>
<span class="sd">            A NumPy array containing categorical data for the prediction locations (`locs2`). If provided,</span>
<span class="sd">            the data points will be permuted according to `cats2`. Default is None.</span>
<span class="sd">        * subsample : int, optional</span>
<span class="sd">            Specifies the number of parameter samples to be used for prediction when `parameter_sample_size` is set.</span>
<span class="sd">            Only valid if parameters are sampled. Default is None.</span>
<span class="sd">        * reduce : str, optional</span>
<span class="sd">            Specifies the reduction method (&#39;mean&#39; or &#39;median&#39;) to aggregate predictions from multiple parameter samples.</span>
<span class="sd">            Only valid if parameters are sampled. Default is None.</span>
<span class="sd">        * tracker : Callable, optional</span>
<span class="sd">            A tracking function for monitoring progress when making predictions across multiple samples. Default is None.</span>
<span class="sd">        * pair : bool, default=False</span>
<span class="sd">            If True, performs pairwise predictions of mean and variance for each pair of input points in `locs2`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        * m : np.ndarray</span>
<span class="sd">            The predicted mean values for the input locations.</span>
<span class="sd">        * v : np.ndarray</span>
<span class="sd">            The predicted variances for the input locations.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Making predictions for a set of locations:</span>

<span class="sd">        ```</span>
<span class="sd">        from geostat import GP, Model</span>
<span class="sd">        from geostat.kernel import Noise</span>

<span class="sd">        # Create model</span>
<span class="sd">        kernel = Noise(nugget=1.0)</span>
<span class="sd">        model = Model(GP(0, kernel))</span>
<span class="sd">        locs2 = np.array([[7.0, 8.0], [9.0, 10.0]])</span>
<span class="sd">        mean, variance = model.predict(locs2)</span>
<span class="sd">        ```</span>

<span class="sd">        Making predictions with categorical data:</span>

<span class="sd">        ```</span>
<span class="sd">        cats2 = np.array([1, 2])</span>
<span class="sd">        mean, variance = model.predict(locs2, cats2=cats2)</span>
<span class="sd">        ```</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - If `subsample` is specified, it should be used only when `parameter_sample_size` is defined.</span>
<span class="sd">        - The `reduce` parameter allows aggregation of predictions, but it&#39;s valid only with sampled parameters.</span>
<span class="sd">        - The method supports pairwise predictions by setting `pair=True`, which is useful for predicting </span>
<span class="sd">        the covariance between two sets of locations.</span>
<span class="sd">        - The internal `interpolate_batch` and `interpolate_pair_batch` functions handle the prediction computations</span>
<span class="sd">        in a batched manner to support large datasets efficiently.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="n">subsample</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_sample_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> \
            <span class="s1">&#39;`subsample` is only valid with sampled parameters&#39;</span>

        <span class="k">assert</span> <span class="n">reduce</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_sample_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> \
            <span class="s1">&#39;`reduce` is only valid with sampled parameters&#39;</span>

        <span class="k">assert</span> <span class="n">subsample</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">reduce</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> \
            <span class="s1">&#39;`subsample` and `reduce` cannot both be given&#39;</span>

        <span class="k">if</span> <span class="n">tracker</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">tracker</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">locs2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;Mismatch in location dimensions&#39;</span>
        <span class="k">if</span> <span class="n">cats2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">cats2</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">locs2</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;Mismatched shapes in cats and locs&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cats2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">locs2</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">interpolate_batch</span><span class="p">(</span><span class="n">A11i</span><span class="p">,</span> <span class="n">locs1</span><span class="p">,</span> <span class="n">vals1diff</span><span class="p">,</span> <span class="n">cats1</span><span class="p">,</span> <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Inputs:</span>
<span class="sd">              locs1.shape = [N1, K]</span>
<span class="sd">              vals1diff.shape = [N1]</span>
<span class="sd">              cats1.shape = [N1]</span>
<span class="sd">              locs2.shape = [N2, K]</span>
<span class="sd">              cats2.shape = [N2]</span>

<span class="sd">            Outputs:</span>
<span class="sd">              u2_mean.shape = [N2]</span>
<span class="sd">              u2_var.shape = [N2]</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">N1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">locs1</span><span class="p">)</span> <span class="c1"># Number of measurements.</span>

            <span class="c1"># Permute datapoints if cats is given.</span>
            <span class="k">if</span> <span class="n">cats2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">perm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">cats2</span><span class="p">)</span>
                <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span> <span class="o">=</span> <span class="n">locs2</span><span class="p">[</span><span class="n">perm</span><span class="p">],</span> <span class="n">cats2</span><span class="p">[</span><span class="n">perm</span><span class="p">]</span>
                <span class="n">locs2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">warp</span><span class="p">(</span><span class="n">locs2</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">({})</span>

            <span class="n">_</span><span class="p">,</span> <span class="n">A12</span> <span class="o">=</span> <span class="n">gp_covariance2</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
                <span class="n">N1</span><span class="p">)</span>

            <span class="n">m2</span><span class="p">,</span> <span class="n">A22</span> <span class="o">=</span> <span class="n">gp_covariance</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>

            <span class="c1"># Restore order if things were permuted.</span>
            <span class="k">if</span> <span class="n">cats2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">revperm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>
                <span class="n">m2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">revperm</span><span class="p">)</span>
                <span class="n">A12</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">A12</span><span class="p">,</span> <span class="n">revperm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">A22</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">A22</span><span class="p">,</span> <span class="n">revperm</span><span class="p">),</span> <span class="n">revperm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">u2_mean</span> <span class="o">=</span> <span class="n">m2</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ab,a-&gt;b&#39;</span><span class="p">,</span> <span class="n">A12</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ab,b-&gt;a&#39;</span><span class="p">,</span> <span class="n">A11i</span><span class="p">,</span> <span class="n">vals1diff</span><span class="p">))</span>
            <span class="n">u2_var</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">diag_part</span><span class="p">(</span><span class="n">A22</span><span class="p">)</span> <span class="o">-</span>  <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ab,ab-&gt;b&#39;</span><span class="p">,</span> <span class="n">A12</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">A11i</span><span class="p">,</span> <span class="n">A12</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">u2_mean</span><span class="p">,</span> <span class="n">u2_var</span>

        <span class="k">def</span> <span class="nf">interpolate_pair_batch</span><span class="p">(</span><span class="n">A11i</span><span class="p">,</span> <span class="n">locs1</span><span class="p">,</span> <span class="n">vals1diff</span><span class="p">,</span> <span class="n">cats1</span><span class="p">,</span> <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Inputs:</span>
<span class="sd">              locs1.shape = [N1, K]</span>
<span class="sd">              vals1diff.shape = [N1]</span>
<span class="sd">              cats1.shape = [N1]</span>
<span class="sd">              locs2.shape = [N2, 2, K]</span>
<span class="sd">              cats2.shape = [N2]</span>

<span class="sd">            Outputs:</span>
<span class="sd">              u2_mean.shape = [N2, 2]</span>
<span class="sd">              u2_var.shape = [N2, 2, 2]</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">N1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">locs1</span><span class="p">)</span> <span class="c1"># Number of measurements.</span>
            <span class="n">N2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">locs2</span><span class="p">)</span> <span class="c1"># Number of prediction pairs.</span>

            <span class="c1"># Permute datapoints if cats is given.</span>
            <span class="n">perm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">cats2</span><span class="p">)</span>
            <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span> <span class="o">=</span> <span class="n">locs2</span><span class="p">[</span><span class="n">perm</span><span class="p">],</span> <span class="n">cats2</span><span class="p">[</span><span class="n">perm</span><span class="p">]</span>

            <span class="c1"># Warp locs2.</span>
            <span class="n">locs2_shape</span> <span class="o">=</span> <span class="n">locs2</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">locs2</span> <span class="o">=</span> <span class="n">locs2</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">locs2_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>  <span class="c1"># Shape into matrix.</span>
            <span class="n">locs2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">warp</span><span class="p">(</span><span class="n">locs2</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">({})</span>
            <span class="n">locs2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">locs2</span><span class="p">,</span> <span class="n">locs2_shape</span><span class="p">)</span>  <span class="c1"># Revert shape.</span>

            <span class="n">_</span><span class="p">,</span> <span class="n">A12</span> <span class="o">=</span> <span class="n">gp_covariance2</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
                <span class="n">N1</span><span class="p">)</span>

            <span class="n">_</span><span class="p">,</span> <span class="n">A13</span> <span class="o">=</span> <span class="n">gp_covariance2</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs2</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
                <span class="n">N1</span><span class="p">)</span>

            <span class="n">m2</span><span class="p">,</span> <span class="n">A22</span> <span class="o">=</span> <span class="n">gp_covariance</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>

            <span class="n">m3</span><span class="p">,</span> <span class="n">A33</span> <span class="o">=</span> <span class="n">gp_covariance</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs2</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>

            <span class="n">_</span><span class="p">,</span> <span class="n">A23</span> <span class="o">=</span> <span class="n">gp_covariance2</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs2</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
                <span class="n">N2</span><span class="p">)</span>

            <span class="c1"># Reassemble into more useful shapes.</span>

            <span class="n">A12</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">A12</span><span class="p">,</span> <span class="n">A13</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># [N1, N2, 2]</span>

            <span class="n">m2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">m2</span><span class="p">,</span> <span class="n">m3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># [N2, 2]</span>

            <span class="n">A22</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">diag_part</span><span class="p">(</span><span class="n">A22</span><span class="p">)</span>
            <span class="n">A33</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">diag_part</span><span class="p">(</span><span class="n">A33</span><span class="p">)</span>
            <span class="n">A23</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">diag_part</span><span class="p">(</span><span class="n">A23</span><span class="p">)</span>
            <span class="n">A22</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">A22</span><span class="p">,</span> <span class="n">A23</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">A23</span><span class="p">,</span> <span class="n">A33</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># [N2, 2, 2]</span>

            <span class="c1"># Restore order if things were permuted.</span>
            <span class="n">revperm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">revperm</span><span class="p">)</span>
            <span class="n">A12</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">A12</span><span class="p">,</span> <span class="n">revperm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">A22</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">A22</span><span class="p">,</span> <span class="n">revperm</span><span class="p">)</span>

            <span class="n">u2_mean</span> <span class="o">=</span> <span class="n">m2</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abc,a-&gt;bc&#39;</span><span class="p">,</span> <span class="n">A12</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ab,b-&gt;a&#39;</span><span class="p">,</span> <span class="n">A11i</span><span class="p">,</span> <span class="n">vals1diff</span><span class="p">))</span>
            <span class="n">u2_var</span> <span class="o">=</span> <span class="n">A22</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abc,abd-&gt;bcd&#39;</span><span class="p">,</span> <span class="n">A12</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ae,ebd-&gt;abd&#39;</span><span class="p">,</span> <span class="n">A11i</span><span class="p">,</span> <span class="n">A12</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">u2_mean</span><span class="p">,</span> <span class="n">u2_var</span>

        <span class="k">def</span> <span class="nf">interpolate</span><span class="p">(</span><span class="n">locs1</span><span class="p">,</span> <span class="n">vals1</span><span class="p">,</span> <span class="n">cats1</span><span class="p">,</span> <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span><span class="p">,</span> <span class="n">pair</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="c1"># Interpolate in batches.</span>
            <span class="n">batch_size</span> <span class="o">=</span> <span class="n">locs1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>

            <span class="n">for_gp</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">locs2</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">batch_size</span>
                <span class="n">subset</span> <span class="o">=</span> <span class="n">locs2</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">],</span> <span class="n">cats2</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                <span class="n">for_gp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>

            <span class="c1"># Permute datapoints if cats is given.</span>
            <span class="k">if</span> <span class="n">cats1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">perm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">cats1</span><span class="p">)</span>
                <span class="n">locs1</span><span class="p">,</span> <span class="n">vals1</span><span class="p">,</span> <span class="n">cats1</span> <span class="o">=</span> <span class="n">locs1</span><span class="p">[</span><span class="n">perm</span><span class="p">],</span> <span class="n">vals1</span><span class="p">[</span><span class="n">perm</span><span class="p">],</span> <span class="n">cats1</span><span class="p">[</span><span class="n">perm</span><span class="p">]</span>

            <span class="n">locs1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">warp</span><span class="p">(</span><span class="n">locs1</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">({})</span>

            <span class="n">m1</span><span class="p">,</span> <span class="n">A11</span> <span class="o">=</span> <span class="n">gp_covariance</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>

            <span class="n">A11i</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">A11</span><span class="p">)</span>

            <span class="n">u2_mean_s</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">u2_var_s</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate_pair_batch</span> <span class="k">if</span> <span class="n">pair</span> <span class="k">else</span> <span class="n">interpolate_batch</span>

            <span class="k">for</span> <span class="n">locs_subset</span><span class="p">,</span> <span class="n">cats_subset</span> <span class="ow">in</span> <span class="n">for_gp</span><span class="p">:</span>
                <span class="n">u2_mean</span><span class="p">,</span> <span class="n">u2_var</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">A11i</span><span class="p">,</span> <span class="n">locs1</span><span class="p">,</span> <span class="n">vals1</span> <span class="o">-</span> <span class="n">m1</span><span class="p">,</span> <span class="n">cats1</span><span class="p">,</span> <span class="n">locs_subset</span><span class="p">,</span> <span class="n">cats_subset</span><span class="p">)</span>
                <span class="n">u2_mean</span> <span class="o">=</span> <span class="n">u2_mean</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
                <span class="n">u2_var</span> <span class="o">=</span> <span class="n">u2_var</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
                <span class="n">u2_mean_s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u2_mean</span><span class="p">)</span>
                <span class="n">u2_var_s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u2_var</span><span class="p">)</span>

            <span class="n">u2_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">u2_mean_s</span><span class="p">)</span>
            <span class="n">u2_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">u2_var_s</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">u2_mean</span><span class="p">,</span> <span class="n">u2_var</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_sample_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">m</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cats</span><span class="p">,</span> <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span><span class="p">,</span> <span class="n">pair</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">reduce</span> <span class="o">==</span> <span class="s1">&#39;median&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">map_structure</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
            <span class="n">m</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cats</span><span class="p">,</span> <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">pair</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">reduce</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">map_structure</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
            <span class="n">m</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cats</span><span class="p">,</span> <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">pair</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_sample_size</span>

            <span class="k">if</span> <span class="n">subsample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">subsample</span> <span class="o">&lt;=</span> <span class="n">samples</span><span class="p">,</span> <span class="s1">&#39;`subsample` may not exceed sample size&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subsample</span> <span class="o">=</span> <span class="n">samples</span>

            <span class="c1"># Thin by picking roughly equally-spaced samples.</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="o">*</span> <span class="n">subsample</span> <span class="o">/</span> <span class="n">samples</span> <span class="o">%</span> <span class="mi">1</span>
            <span class="n">pick</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="kc">True</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&gt;=</span> <span class="n">a</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">map_structure</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">pick</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

            <span class="c1"># Make a prediction for each sample.</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tracker</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">subsample</span><span class="p">)):</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">map_structure</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">parameters</span><span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cats</span><span class="p">,</span> <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">pair</span><span class="p">))</span>

            <span class="n">mm</span><span class="p">,</span> <span class="n">vv</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">results</span><span class="p">)]</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">mm</span><span class="p">)</span> <span class="o">+</span> <span class="n">vv</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.geostat.model.Model.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">locs</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">cats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">iters</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">reg</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>fit(locs, vals, cats=None, step_size=0.01, iters=100, reg=None)</p>
<p>Trains the model using the provided location and value data by optimizing the parameters of the Gaussian Process (GP)
using the Adam optimizer. Optionally performs regularization and can handle categorical data.</p>
<h6 id="src.geostat.model.Model.fit--parameters">Parameters</h6>
<ul>
<li>locs : np.ndarray
    A NumPy array containing the input locations for training.</li>
<li>vals : np.ndarray
    A NumPy array containing observed values corresponding to the <code>locs</code>.</li>
<li>cats : np.ndarray, optional
    A NumPy array containing categorical data for each observation in <code>locs</code>. If provided,
    the data is sorted according to <code>cats</code> to enable stratified training. Defaults to None.</li>
<li>step_size : float, default=0.01
    The learning rate for the Adam optimizer.</li>
<li>iters : int, default=100
    The total number of iterations to run for training.</li>
<li>reg : float or None, optional
    Regularization penalty parameter. If None, no regularization is applied.</li>
</ul>
<h6 id="src.geostat.model.Model.fit--returns">Returns</h6>
<ul>
<li>self : Model
    The model instance with updated parameters, allowing for method chaining.</li>
</ul>
<h6 id="src.geostat.model.Model.fit--examples">Examples</h6>
<p>Fitting a model using training data:</p>
<pre><code>from geostat import GP, Model
from geostat.kernel import Noise

# Create model
kernel = Noise(nugget=1.0)
model = Model(GP(0, kernel))

# Fit model
locs = np.array([[1.0, 2.0], [2.0, 3.0], [3.0, 4.0]])
vals = np.array([10.0, 15.0, 20.0])
model.fit(locs, vals, step_size=0.05, iters=500)
</code></pre>
<p>Using categorical data for training:</p>
<pre><code>cats = np.array([1, 1, 2])
model.fit(locs, vals, cats=cats, step_size=0.01, iters=300)
</code></pre>
<h6 id="src.geostat.model.Model.fit--notes">Notes</h6>
<ul>
<li>The <code>fit</code> method uses the Adam optimizer to minimize the negative log-likelihood (<code>ll</code>) and any regularization 
penalties specified by <code>reg</code>.</li>
<li>During training, if <code>cats</code> are provided, data points are sorted according to <code>cats</code> to ensure grouped training.</li>
<li>The <code>verbose</code> flag determines whether training progress is printed after each iteration.</li>
<li>After training, parameter values are saved and can be accessed or updated using the model's attributes.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>src/geostat/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locs</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">cats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">iters</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">reg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    fit(locs, vals, cats=None, step_size=0.01, iters=100, reg=None)</span>

<span class="sd">    Trains the model using the provided location and value data by optimizing the parameters of the Gaussian Process (GP)</span>
<span class="sd">    using the Adam optimizer. Optionally performs regularization and can handle categorical data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    * locs : np.ndarray</span>
<span class="sd">        A NumPy array containing the input locations for training.</span>
<span class="sd">    * vals : np.ndarray</span>
<span class="sd">        A NumPy array containing observed values corresponding to the `locs`.</span>
<span class="sd">    * cats : np.ndarray, optional</span>
<span class="sd">        A NumPy array containing categorical data for each observation in `locs`. If provided,</span>
<span class="sd">        the data is sorted according to `cats` to enable stratified training. Defaults to None.</span>
<span class="sd">    * step_size : float, default=0.01</span>
<span class="sd">        The learning rate for the Adam optimizer.</span>
<span class="sd">    * iters : int, default=100</span>
<span class="sd">        The total number of iterations to run for training.</span>
<span class="sd">    * reg : float or None, optional</span>
<span class="sd">        Regularization penalty parameter. If None, no regularization is applied.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    * self : Model</span>
<span class="sd">        The model instance with updated parameters, allowing for method chaining.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Fitting a model using training data:</span>

<span class="sd">    ```</span>
<span class="sd">    from geostat import GP, Model</span>
<span class="sd">    from geostat.kernel import Noise</span>

<span class="sd">    # Create model</span>
<span class="sd">    kernel = Noise(nugget=1.0)</span>
<span class="sd">    model = Model(GP(0, kernel))</span>

<span class="sd">    # Fit model</span>
<span class="sd">    locs = np.array([[1.0, 2.0], [2.0, 3.0], [3.0, 4.0]])</span>
<span class="sd">    vals = np.array([10.0, 15.0, 20.0])</span>
<span class="sd">    model.fit(locs, vals, step_size=0.05, iters=500)</span>
<span class="sd">    ```</span>

<span class="sd">    Using categorical data for training:</span>

<span class="sd">    ```</span>
<span class="sd">    cats = np.array([1, 1, 2])</span>
<span class="sd">    model.fit(locs, vals, cats=cats, step_size=0.01, iters=300)</span>
<span class="sd">    ```</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The `fit` method uses the Adam optimizer to minimize the negative log-likelihood (`ll`) and any regularization </span>
<span class="sd">    penalties specified by `reg`.</span>
<span class="sd">    - During training, if `cats` are provided, data points are sorted according to `cats` to ensure grouped training.</span>
<span class="sd">    - The `verbose` flag determines whether training progress is printed after each iteration.</span>
<span class="sd">    - After training, parameter values are saved and can be accessed or updated using the model&#39;s attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Collect parameters and create TF parameters.</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gather_vars</span><span class="p">()</span>

    <span class="c1"># Permute datapoints if cats is given.</span>
    <span class="k">if</span> <span class="n">cats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span>
        <span class="n">perm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span>
        <span class="n">locs</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">cats</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="n">perm</span><span class="p">],</span> <span class="n">vals</span><span class="p">[</span><span class="n">perm</span><span class="p">],</span> <span class="n">cats</span><span class="p">[</span><span class="n">perm</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">locs</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">perm</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Data dict.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;warplocs&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">warp</span><span class="p">(</span><span class="n">locs</span><span class="p">),</span>
        <span class="s1">&#39;vals&#39;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
        <span class="s1">&#39;cats&#39;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)}</span>

    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="n">step_size</span><span class="p">)</span>

    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Iteration count.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">iters</span> <span class="o">/</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">ll</span><span class="p">,</span> <span class="n">reg_penalty</span> <span class="o">=</span> <span class="n">gp_train_step</span><span class="p">(</span>
                <span class="n">optimizer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span> <span class="n">reg</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">time_elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span>
              <span class="nb">dict</span><span class="p">(</span><span class="nb">iter</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">ll</span><span class="o">=</span><span class="n">ll</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time_elapsed</span><span class="p">,</span> <span class="n">reg</span><span class="o">=</span><span class="n">reg_penalty</span><span class="p">)</span> <span class="o">|</span>
              <span class="p">{</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">surface</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">()})</span>

    <span class="c1"># Save parameter values.</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">p</span><span class="o">.</span><span class="n">update_value</span><span class="p">()</span>

    <span class="c1"># Restore order if things were permuted.</span>
    <span class="k">if</span> <span class="n">perm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">revperm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>
        <span class="n">locs</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">cats</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="n">revperm</span><span class="p">],</span> <span class="n">vals</span><span class="p">[</span><span class="n">revperm</span><span class="p">],</span> <span class="n">cats</span><span class="p">[</span><span class="n">revperm</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">locs</span> <span class="o">=</span> <span class="n">locs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cats</span> <span class="o">=</span> <span class="n">cats</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.geostat.model.Model.generate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate</span><span class="p">(</span><span class="n">locs</span><span class="p">,</span> <span class="n">cats</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>generate(locs, cats=None)</p>
<p>Generates synthetic data values from the Gaussian Process (GP) model based on the provided location data.
This method simulates values based on the GP's covariance structure, allowing for random sample generation.</p>
<h6 id="src.geostat.model.Model.generate--parameters">Parameters</h6>
<ul>
<li>locs : np.ndarray
    A NumPy array containing the input locations for which to generate synthetic values.</li>
<li>cats : np.ndarray, optional
    A NumPy array containing categorical data corresponding to <code>locs</code>. If provided, data points 
    are permuted according to <code>cats</code> for stratified generation. Defaults to None.</li>
</ul>
<h6 id="src.geostat.model.Model.generate--returns">Returns</h6>
<ul>
<li>self : Model
    The model instance with generated values stored in <code>self.vals</code> and corresponding locations stored 
    in <code>self.locs</code>. This enables method chaining.</li>
</ul>
<h6 id="src.geostat.model.Model.generate--examples">Examples</h6>
<p>Generating synthetic values for a set of locations:</p>
<pre><code>from geostat import GP, Model
from geostat.kernel import Noise

# Create model
kernel = Noise(nugget=1.0)
model = Model(GP(0, kernel))

# Generate values based on locs
locs = np.array([[1.0, 2.0], [3.0, 4.0], [5.0, 6.0]])
model.generate(locs)
generated_vals = model.vals  # Access the generated values
</code></pre>
<h6 id="src.geostat.model.Model.generate--notes">Notes</h6>
<ul>
<li>Conditional generation is currently not supported, and this method will raise an assertion error if 
<code>self.locs</code> and <code>self.vals</code> are already defined.</li>
<li>Generation from a distribution is not yet supported, and an assertion error will be raised if 
<code>self.parameter_sample_size</code> is not <code>None</code>.</li>
<li>If <code>cats</code> are provided, the data is permuted according to <code>cats</code> for stratified generation, and 
the original order is restored before returning.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>src/geostat/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locs</span><span class="p">,</span> <span class="n">cats</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    generate(locs, cats=None)</span>

<span class="sd">    Generates synthetic data values from the Gaussian Process (GP) model based on the provided location data.</span>
<span class="sd">    This method simulates values based on the GP&#39;s covariance structure, allowing for random sample generation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    * locs : np.ndarray</span>
<span class="sd">        A NumPy array containing the input locations for which to generate synthetic values.</span>
<span class="sd">    * cats : np.ndarray, optional</span>
<span class="sd">        A NumPy array containing categorical data corresponding to `locs`. If provided, data points </span>
<span class="sd">        are permuted according to `cats` for stratified generation. Defaults to None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    * self : Model</span>
<span class="sd">        The model instance with generated values stored in `self.vals` and corresponding locations stored </span>
<span class="sd">        in `self.locs`. This enables method chaining.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Generating synthetic values for a set of locations:</span>

<span class="sd">    ```</span>
<span class="sd">    from geostat import GP, Model</span>
<span class="sd">    from geostat.kernel import Noise</span>

<span class="sd">    # Create model</span>
<span class="sd">    kernel = Noise(nugget=1.0)</span>
<span class="sd">    model = Model(GP(0, kernel))</span>

<span class="sd">    # Generate values based on locs</span>
<span class="sd">    locs = np.array([[1.0, 2.0], [3.0, 4.0], [5.0, 6.0]])</span>
<span class="sd">    model.generate(locs)</span>
<span class="sd">    generated_vals = model.vals  # Access the generated values</span>
<span class="sd">    ```</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Conditional generation is currently not supported, and this method will raise an assertion error if </span>
<span class="sd">    `self.locs` and `self.vals` are already defined.</span>
<span class="sd">    - Generation from a distribution is not yet supported, and an assertion error will be raised if </span>
<span class="sd">    `self.parameter_sample_size` is not `None`.</span>
<span class="sd">    - If `cats` are provided, the data is permuted according to `cats` for stratified generation, and </span>
<span class="sd">    the original order is restored before returning.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">locs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Conditional generation not yet supported&#39;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_sample_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Generation from a distribution not yet supported&#39;</span>

    <span class="n">locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span>

    <span class="c1"># Permute datapoints if cats is given.</span>
    <span class="k">if</span> <span class="n">cats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span>
        <span class="n">perm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span>
        <span class="n">locs</span><span class="p">,</span> <span class="n">cats</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="n">perm</span><span class="p">],</span> <span class="n">cats</span><span class="p">[</span><span class="n">perm</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">locs</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">perm</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">m</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="n">gp_covariance</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warp</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">({}),</span>
        <span class="kc">None</span> <span class="k">if</span> <span class="n">cats</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>

    <span class="n">vals</span> <span class="o">=</span> <span class="n">MVN</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cholesky</span><span class="p">(</span><span class="n">S</span><span class="p">))</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="c1"># Restore order if things were permuted.</span>
    <span class="k">if</span> <span class="n">perm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">revperm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>
        <span class="n">locs</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">cats</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="n">revperm</span><span class="p">],</span> <span class="n">vals</span><span class="p">[</span><span class="n">revperm</span><span class="p">],</span> <span class="n">cats</span><span class="p">[</span><span class="n">revperm</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">locs</span> <span class="o">=</span> <span class="n">locs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cats</span> <span class="o">=</span> <span class="n">cats</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.geostat.model.Model.predict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">subsample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reduce</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tracker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pair</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>predict(locs2, cats2=None, *, subsample=None, reduce=None, tracker=None, pair=False)</p>
<p>Performs Gaussian Process (GP) predictions of the mean and variance for the given location data.
Supports batch predictions for large datasets and can handle categorical data.</p>
<h6 id="src.geostat.model.Model.predict--parameters">Parameters</h6>
<ul>
<li>locs2 : np.ndarray
    A NumPy array containing the input locations for which predictions are to be made.</li>
<li>cats2 : np.ndarray, optional
    A NumPy array containing categorical data for the prediction locations (<code>locs2</code>). If provided,
    the data points will be permuted according to <code>cats2</code>. Default is None.</li>
<li>subsample : int, optional
    Specifies the number of parameter samples to be used for prediction when <code>parameter_sample_size</code> is set.
    Only valid if parameters are sampled. Default is None.</li>
<li>reduce : str, optional
    Specifies the reduction method ('mean' or 'median') to aggregate predictions from multiple parameter samples.
    Only valid if parameters are sampled. Default is None.</li>
<li>tracker : Callable, optional
    A tracking function for monitoring progress when making predictions across multiple samples. Default is None.</li>
<li>pair : bool, default=False
    If True, performs pairwise predictions of mean and variance for each pair of input points in <code>locs2</code>.</li>
</ul>
<h6 id="src.geostat.model.Model.predict--returns">Returns</h6>
<ul>
<li>m : np.ndarray
    The predicted mean values for the input locations.</li>
<li>v : np.ndarray
    The predicted variances for the input locations.</li>
</ul>
<h6 id="src.geostat.model.Model.predict--examples">Examples</h6>
<p>Making predictions for a set of locations:</p>
<pre><code>from geostat import GP, Model
from geostat.kernel import Noise

# Create model
kernel = Noise(nugget=1.0)
model = Model(GP(0, kernel))
locs2 = np.array([[7.0, 8.0], [9.0, 10.0]])
mean, variance = model.predict(locs2)
</code></pre>
<p>Making predictions with categorical data:</p>
<pre><code>cats2 = np.array([1, 2])
mean, variance = model.predict(locs2, cats2=cats2)
</code></pre>
<h6 id="src.geostat.model.Model.predict--notes">Notes</h6>
<ul>
<li>If <code>subsample</code> is specified, it should be used only when <code>parameter_sample_size</code> is defined.</li>
<li>The <code>reduce</code> parameter allows aggregation of predictions, but it's valid only with sampled parameters.</li>
<li>The method supports pairwise predictions by setting <code>pair=True</code>, which is useful for predicting 
the covariance between two sets of locations.</li>
<li>The internal <code>interpolate_batch</code> and <code>interpolate_pair_batch</code> functions handle the prediction computations
in a batched manner to support large datasets efficiently.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>src/geostat/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">subsample</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reduce</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tracker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pair</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    predict(locs2, cats2=None, *, subsample=None, reduce=None, tracker=None, pair=False)</span>

<span class="sd">    Performs Gaussian Process (GP) predictions of the mean and variance for the given location data.</span>
<span class="sd">    Supports batch predictions for large datasets and can handle categorical data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    * locs2 : np.ndarray</span>
<span class="sd">        A NumPy array containing the input locations for which predictions are to be made.</span>
<span class="sd">    * cats2 : np.ndarray, optional</span>
<span class="sd">        A NumPy array containing categorical data for the prediction locations (`locs2`). If provided,</span>
<span class="sd">        the data points will be permuted according to `cats2`. Default is None.</span>
<span class="sd">    * subsample : int, optional</span>
<span class="sd">        Specifies the number of parameter samples to be used for prediction when `parameter_sample_size` is set.</span>
<span class="sd">        Only valid if parameters are sampled. Default is None.</span>
<span class="sd">    * reduce : str, optional</span>
<span class="sd">        Specifies the reduction method (&#39;mean&#39; or &#39;median&#39;) to aggregate predictions from multiple parameter samples.</span>
<span class="sd">        Only valid if parameters are sampled. Default is None.</span>
<span class="sd">    * tracker : Callable, optional</span>
<span class="sd">        A tracking function for monitoring progress when making predictions across multiple samples. Default is None.</span>
<span class="sd">    * pair : bool, default=False</span>
<span class="sd">        If True, performs pairwise predictions of mean and variance for each pair of input points in `locs2`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    * m : np.ndarray</span>
<span class="sd">        The predicted mean values for the input locations.</span>
<span class="sd">    * v : np.ndarray</span>
<span class="sd">        The predicted variances for the input locations.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Making predictions for a set of locations:</span>

<span class="sd">    ```</span>
<span class="sd">    from geostat import GP, Model</span>
<span class="sd">    from geostat.kernel import Noise</span>

<span class="sd">    # Create model</span>
<span class="sd">    kernel = Noise(nugget=1.0)</span>
<span class="sd">    model = Model(GP(0, kernel))</span>
<span class="sd">    locs2 = np.array([[7.0, 8.0], [9.0, 10.0]])</span>
<span class="sd">    mean, variance = model.predict(locs2)</span>
<span class="sd">    ```</span>

<span class="sd">    Making predictions with categorical data:</span>

<span class="sd">    ```</span>
<span class="sd">    cats2 = np.array([1, 2])</span>
<span class="sd">    mean, variance = model.predict(locs2, cats2=cats2)</span>
<span class="sd">    ```</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - If `subsample` is specified, it should be used only when `parameter_sample_size` is defined.</span>
<span class="sd">    - The `reduce` parameter allows aggregation of predictions, but it&#39;s valid only with sampled parameters.</span>
<span class="sd">    - The method supports pairwise predictions by setting `pair=True`, which is useful for predicting </span>
<span class="sd">    the covariance between two sets of locations.</span>
<span class="sd">    - The internal `interpolate_batch` and `interpolate_pair_batch` functions handle the prediction computations</span>
<span class="sd">    in a batched manner to support large datasets efficiently.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="n">subsample</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_sample_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> \
        <span class="s1">&#39;`subsample` is only valid with sampled parameters&#39;</span>

    <span class="k">assert</span> <span class="n">reduce</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_sample_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> \
        <span class="s1">&#39;`reduce` is only valid with sampled parameters&#39;</span>

    <span class="k">assert</span> <span class="n">subsample</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">reduce</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> \
        <span class="s1">&#39;`subsample` and `reduce` cannot both be given&#39;</span>

    <span class="k">if</span> <span class="n">tracker</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">tracker</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>

    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">locs2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;Mismatch in location dimensions&#39;</span>
    <span class="k">if</span> <span class="n">cats2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">cats2</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">locs2</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;Mismatched shapes in cats and locs&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cats2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">locs2</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">interpolate_batch</span><span class="p">(</span><span class="n">A11i</span><span class="p">,</span> <span class="n">locs1</span><span class="p">,</span> <span class="n">vals1diff</span><span class="p">,</span> <span class="n">cats1</span><span class="p">,</span> <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inputs:</span>
<span class="sd">          locs1.shape = [N1, K]</span>
<span class="sd">          vals1diff.shape = [N1]</span>
<span class="sd">          cats1.shape = [N1]</span>
<span class="sd">          locs2.shape = [N2, K]</span>
<span class="sd">          cats2.shape = [N2]</span>

<span class="sd">        Outputs:</span>
<span class="sd">          u2_mean.shape = [N2]</span>
<span class="sd">          u2_var.shape = [N2]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">N1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">locs1</span><span class="p">)</span> <span class="c1"># Number of measurements.</span>

        <span class="c1"># Permute datapoints if cats is given.</span>
        <span class="k">if</span> <span class="n">cats2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">perm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">cats2</span><span class="p">)</span>
            <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span> <span class="o">=</span> <span class="n">locs2</span><span class="p">[</span><span class="n">perm</span><span class="p">],</span> <span class="n">cats2</span><span class="p">[</span><span class="n">perm</span><span class="p">]</span>
            <span class="n">locs2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">warp</span><span class="p">(</span><span class="n">locs2</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">({})</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">A12</span> <span class="o">=</span> <span class="n">gp_covariance2</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
            <span class="n">N1</span><span class="p">)</span>

        <span class="n">m2</span><span class="p">,</span> <span class="n">A22</span> <span class="o">=</span> <span class="n">gp_covariance</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>

        <span class="c1"># Restore order if things were permuted.</span>
        <span class="k">if</span> <span class="n">cats2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">revperm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">revperm</span><span class="p">)</span>
            <span class="n">A12</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">A12</span><span class="p">,</span> <span class="n">revperm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">A22</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">A22</span><span class="p">,</span> <span class="n">revperm</span><span class="p">),</span> <span class="n">revperm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">u2_mean</span> <span class="o">=</span> <span class="n">m2</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ab,a-&gt;b&#39;</span><span class="p">,</span> <span class="n">A12</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ab,b-&gt;a&#39;</span><span class="p">,</span> <span class="n">A11i</span><span class="p">,</span> <span class="n">vals1diff</span><span class="p">))</span>
        <span class="n">u2_var</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">diag_part</span><span class="p">(</span><span class="n">A22</span><span class="p">)</span> <span class="o">-</span>  <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ab,ab-&gt;b&#39;</span><span class="p">,</span> <span class="n">A12</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">A11i</span><span class="p">,</span> <span class="n">A12</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">u2_mean</span><span class="p">,</span> <span class="n">u2_var</span>

    <span class="k">def</span> <span class="nf">interpolate_pair_batch</span><span class="p">(</span><span class="n">A11i</span><span class="p">,</span> <span class="n">locs1</span><span class="p">,</span> <span class="n">vals1diff</span><span class="p">,</span> <span class="n">cats1</span><span class="p">,</span> <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inputs:</span>
<span class="sd">          locs1.shape = [N1, K]</span>
<span class="sd">          vals1diff.shape = [N1]</span>
<span class="sd">          cats1.shape = [N1]</span>
<span class="sd">          locs2.shape = [N2, 2, K]</span>
<span class="sd">          cats2.shape = [N2]</span>

<span class="sd">        Outputs:</span>
<span class="sd">          u2_mean.shape = [N2, 2]</span>
<span class="sd">          u2_var.shape = [N2, 2, 2]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">N1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">locs1</span><span class="p">)</span> <span class="c1"># Number of measurements.</span>
        <span class="n">N2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">locs2</span><span class="p">)</span> <span class="c1"># Number of prediction pairs.</span>

        <span class="c1"># Permute datapoints if cats is given.</span>
        <span class="n">perm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">cats2</span><span class="p">)</span>
        <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span> <span class="o">=</span> <span class="n">locs2</span><span class="p">[</span><span class="n">perm</span><span class="p">],</span> <span class="n">cats2</span><span class="p">[</span><span class="n">perm</span><span class="p">]</span>

        <span class="c1"># Warp locs2.</span>
        <span class="n">locs2_shape</span> <span class="o">=</span> <span class="n">locs2</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">locs2</span> <span class="o">=</span> <span class="n">locs2</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">locs2_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>  <span class="c1"># Shape into matrix.</span>
        <span class="n">locs2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">warp</span><span class="p">(</span><span class="n">locs2</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">({})</span>
        <span class="n">locs2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">locs2</span><span class="p">,</span> <span class="n">locs2_shape</span><span class="p">)</span>  <span class="c1"># Revert shape.</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">A12</span> <span class="o">=</span> <span class="n">gp_covariance2</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
            <span class="n">N1</span><span class="p">)</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">A13</span> <span class="o">=</span> <span class="n">gp_covariance2</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs2</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
            <span class="n">N1</span><span class="p">)</span>

        <span class="n">m2</span><span class="p">,</span> <span class="n">A22</span> <span class="o">=</span> <span class="n">gp_covariance</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>

        <span class="n">m3</span><span class="p">,</span> <span class="n">A33</span> <span class="o">=</span> <span class="n">gp_covariance</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs2</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">A23</span> <span class="o">=</span> <span class="n">gp_covariance2</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs2</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
            <span class="n">N2</span><span class="p">)</span>

        <span class="c1"># Reassemble into more useful shapes.</span>

        <span class="n">A12</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">A12</span><span class="p">,</span> <span class="n">A13</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># [N1, N2, 2]</span>

        <span class="n">m2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">m2</span><span class="p">,</span> <span class="n">m3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># [N2, 2]</span>

        <span class="n">A22</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">diag_part</span><span class="p">(</span><span class="n">A22</span><span class="p">)</span>
        <span class="n">A33</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">diag_part</span><span class="p">(</span><span class="n">A33</span><span class="p">)</span>
        <span class="n">A23</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">diag_part</span><span class="p">(</span><span class="n">A23</span><span class="p">)</span>
        <span class="n">A22</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">A22</span><span class="p">,</span> <span class="n">A23</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">A23</span><span class="p">,</span> <span class="n">A33</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># [N2, 2, 2]</span>

        <span class="c1"># Restore order if things were permuted.</span>
        <span class="n">revperm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">revperm</span><span class="p">)</span>
        <span class="n">A12</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">A12</span><span class="p">,</span> <span class="n">revperm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">A22</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">A22</span><span class="p">,</span> <span class="n">revperm</span><span class="p">)</span>

        <span class="n">u2_mean</span> <span class="o">=</span> <span class="n">m2</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abc,a-&gt;bc&#39;</span><span class="p">,</span> <span class="n">A12</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ab,b-&gt;a&#39;</span><span class="p">,</span> <span class="n">A11i</span><span class="p">,</span> <span class="n">vals1diff</span><span class="p">))</span>
        <span class="n">u2_var</span> <span class="o">=</span> <span class="n">A22</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;abc,abd-&gt;bcd&#39;</span><span class="p">,</span> <span class="n">A12</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ae,ebd-&gt;abd&#39;</span><span class="p">,</span> <span class="n">A11i</span><span class="p">,</span> <span class="n">A12</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">u2_mean</span><span class="p">,</span> <span class="n">u2_var</span>

    <span class="k">def</span> <span class="nf">interpolate</span><span class="p">(</span><span class="n">locs1</span><span class="p">,</span> <span class="n">vals1</span><span class="p">,</span> <span class="n">cats1</span><span class="p">,</span> <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span><span class="p">,</span> <span class="n">pair</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># Interpolate in batches.</span>
        <span class="n">batch_size</span> <span class="o">=</span> <span class="n">locs1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="n">for_gp</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">locs2</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">batch_size</span>
            <span class="n">subset</span> <span class="o">=</span> <span class="n">locs2</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">],</span> <span class="n">cats2</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">for_gp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>

        <span class="c1"># Permute datapoints if cats is given.</span>
        <span class="k">if</span> <span class="n">cats1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">perm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">cats1</span><span class="p">)</span>
            <span class="n">locs1</span><span class="p">,</span> <span class="n">vals1</span><span class="p">,</span> <span class="n">cats1</span> <span class="o">=</span> <span class="n">locs1</span><span class="p">[</span><span class="n">perm</span><span class="p">],</span> <span class="n">vals1</span><span class="p">[</span><span class="n">perm</span><span class="p">],</span> <span class="n">cats1</span><span class="p">[</span><span class="n">perm</span><span class="p">]</span>

        <span class="n">locs1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">warp</span><span class="p">(</span><span class="n">locs1</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">({})</span>

        <span class="n">m1</span><span class="p">,</span> <span class="n">A11</span> <span class="o">=</span> <span class="n">gp_covariance</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gp</span><span class="p">,</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">locs1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">cats1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>

        <span class="n">A11i</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">A11</span><span class="p">)</span>

        <span class="n">u2_mean_s</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">u2_var_s</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate_pair_batch</span> <span class="k">if</span> <span class="n">pair</span> <span class="k">else</span> <span class="n">interpolate_batch</span>

        <span class="k">for</span> <span class="n">locs_subset</span><span class="p">,</span> <span class="n">cats_subset</span> <span class="ow">in</span> <span class="n">for_gp</span><span class="p">:</span>
            <span class="n">u2_mean</span><span class="p">,</span> <span class="n">u2_var</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">A11i</span><span class="p">,</span> <span class="n">locs1</span><span class="p">,</span> <span class="n">vals1</span> <span class="o">-</span> <span class="n">m1</span><span class="p">,</span> <span class="n">cats1</span><span class="p">,</span> <span class="n">locs_subset</span><span class="p">,</span> <span class="n">cats_subset</span><span class="p">)</span>
            <span class="n">u2_mean</span> <span class="o">=</span> <span class="n">u2_mean</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
            <span class="n">u2_var</span> <span class="o">=</span> <span class="n">u2_var</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
            <span class="n">u2_mean_s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u2_mean</span><span class="p">)</span>
            <span class="n">u2_var_s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u2_var</span><span class="p">)</span>

        <span class="n">u2_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">u2_mean_s</span><span class="p">)</span>
        <span class="n">u2_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">u2_var_s</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">u2_mean</span><span class="p">,</span> <span class="n">u2_var</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_sample_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cats</span><span class="p">,</span> <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span><span class="p">,</span> <span class="n">pair</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">reduce</span> <span class="o">==</span> <span class="s1">&#39;median&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">map_structure</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cats</span><span class="p">,</span> <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">pair</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">reduce</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">map_structure</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cats</span><span class="p">,</span> <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">pair</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_sample_size</span>

        <span class="k">if</span> <span class="n">subsample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">subsample</span> <span class="o">&lt;=</span> <span class="n">samples</span><span class="p">,</span> <span class="s1">&#39;`subsample` may not exceed sample size&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subsample</span> <span class="o">=</span> <span class="n">samples</span>

        <span class="c1"># Thin by picking roughly equally-spaced samples.</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="o">*</span> <span class="n">subsample</span> <span class="o">/</span> <span class="n">samples</span> <span class="o">%</span> <span class="mi">1</span>
        <span class="n">pick</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="kc">True</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&gt;=</span> <span class="n">a</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">map_structure</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">pick</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

        <span class="c1"># Make a prediction for each sample.</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tracker</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">subsample</span><span class="p">)):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">map_structure</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">parameters</span><span class="p">)</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cats</span><span class="p">,</span> <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">pair</span><span class="p">))</span>

        <span class="n">mm</span><span class="p">,</span> <span class="n">vv</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">results</span><span class="p">)]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">mm</span><span class="p">)</span> <span class="o">+</span> <span class="n">vv</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.geostat.model.Model.set" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">set</span><span class="p">(</span><span class="o">**</span><span class="n">values</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>set(**values)</p>
<p>Sets the values of the model's parameters based on the provided keyword arguments.
Each parameter specified must exist in the model; otherwise, a <code>ValueError</code> is raised.</p>
<h6 id="src.geostat.model.Model.set--parameters">Parameters</h6>
<ul>
<li>values : keyword arguments
    A dictionary of parameter names and their corresponding values that should be 
    set in the model. Each key corresponds to a parameter name, and the value is 
    the value to be assigned to that parameter.</li>
</ul>
<h6 id="src.geostat.model.Model.set--returns">Returns</h6>
<ul>
<li>self : Model
    The model instance with updated parameter values, allowing for method chaining.</li>
</ul>
<h6 id="src.geostat.model.Model.set--raises">Raises</h6>
<ul>
<li>ValueError
    If a provided parameter name does not exist in the model's parameters.</li>
</ul>
<h6 id="src.geostat.model.Model.set--examples">Examples</h6>
<p>Update parameter value using <code>set</code>:</p>
<pre><code>from geostat import GP, Model
from geostat.kernel import Noise

# Create model
kernel = Noise(nugget=1.0)
model = Model(GP(0, kernel))

# Update parameters
model.set(nugget=0.5)
</code></pre>
<h6 id="src.geostat.model.Model.set--notes">Notes</h6>
<ul>
<li>The <code>set</code> method retrieves the current parameters using <code>gather_vars</code> and updates 
their values. The associated TensorFlow variables are also recreated.</li>
<li>This method is useful for dynamically updating the model's parameters after initialization.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>src/geostat/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    set(**values)</span>

<span class="sd">    Sets the values of the model&#39;s parameters based on the provided keyword arguments.</span>
<span class="sd">    Each parameter specified must exist in the model; otherwise, a `ValueError` is raised.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    * values : keyword arguments</span>
<span class="sd">        A dictionary of parameter names and their corresponding values that should be </span>
<span class="sd">        set in the model. Each key corresponds to a parameter name, and the value is </span>
<span class="sd">        the value to be assigned to that parameter.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    * self : Model</span>
<span class="sd">        The model instance with updated parameter values, allowing for method chaining.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    * ValueError</span>
<span class="sd">        If a provided parameter name does not exist in the model&#39;s parameters.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Update parameter value using `set`:</span>

<span class="sd">    ```</span>
<span class="sd">    from geostat import GP, Model</span>
<span class="sd">    from geostat.kernel import Noise</span>

<span class="sd">    # Create model</span>
<span class="sd">    kernel = Noise(nugget=1.0)</span>
<span class="sd">    model = Model(GP(0, kernel))</span>

<span class="sd">    # Update parameters</span>
<span class="sd">    model.set(nugget=0.5)</span>
<span class="sd">    ```</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The `set` method retrieves the current parameters using `gather_vars` and updates </span>
<span class="sd">    their values. The associated TensorFlow variables are also recreated.</span>
<span class="sd">    - This method is useful for dynamically updating the model&#39;s parameters after initialization.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gather_vars</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">v</span>
            <span class="n">parameters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">create_tf_variable</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> is not a parameter&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="src.geostat.model.NormalizingFeaturizer" class="doc doc-heading">
            <code>NormalizingFeaturizer</code>


</h3>


    <div class="doc doc-contents ">


      <p>NormalizingFeaturizer class for producing normalized feature matrices (F matrix) with an intercept.</p>
<p>The <code>NormalizingFeaturizer</code> takes raw location data and applies a specified featurization function.
It normalizes the resulting features and remembers normalization parameters using the mean and standard deviation calculated from the 
original data and adds an intercept feature (a column of ones) to the matrix.</p>
<h5 id="src.geostat.model.NormalizingFeaturizer--parameters">Parameters</h5>
<ul>
<li>featurization : Callable
    A function or callable that defines how the input location data should be featurized.</li>
<li>locs : array-like or Tensor
    The input location data used for calculating normalization parameters (mean and standard 
    deviation) and featurizing new data.</li>
</ul>
<h5 id="src.geostat.model.NormalizingFeaturizer--examples">Examples</h5>
<p>Creating a <code>NormalizingFeaturizer</code> using a custom featurization function and location data:</p>
<pre><code>import tensorflow as tf
from geostat.model import NormalizingFeaturizer

# Define a simple featurization function
def custom_featurizer(x, y):
    return x, y, x * y

# Sample location data
locs = tf.constant([[1.0, 2.0], [3.0, 4.0], [5.0, 6.0]])

# Create the NormalizingFeaturizer
norm_featurizer = NormalizingFeaturizer(custom_featurizer, locs)
</code></pre>
<p>Using the <code>NormalizingFeaturizer</code> to featurize new location data:</p>
<pre><code>new_locs = tf.constant([[7.0, 8.0], [9.0, 10.0]])
F_matrix = norm_featurizer(new_locs)
# F_matrix will contain normalized features with an additional intercept column
</code></pre>
<h5 id="src.geostat.model.NormalizingFeaturizer--notes">Notes</h5>
<ul>
<li>The normalization parameters (<code>unnorm_mean</code> and <code>unnorm_std</code>) are calculated based on the 
  initial <code>locs</code> data provided during initialization.</li>
<li>The <code>__call__</code> method applies the normalization and adds an intercept feature when used 
  to featurize new location data.</li>
</ul>

              <details class="quote">
                <summary>Source code in <code>src/geostat/model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NormalizingFeaturizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NormalizingFeaturizer class for producing normalized feature matrices (F matrix) with an intercept.</span>

<span class="sd">    The `NormalizingFeaturizer` takes raw location data and applies a specified featurization function.</span>
<span class="sd">    It normalizes the resulting features and remembers normalization parameters using the mean and standard deviation calculated from the </span>
<span class="sd">    original data and adds an intercept feature (a column of ones) to the matrix.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    * featurization : Callable</span>
<span class="sd">        A function or callable that defines how the input location data should be featurized.</span>
<span class="sd">    * locs : array-like or Tensor</span>
<span class="sd">        The input location data used for calculating normalization parameters (mean and standard </span>
<span class="sd">        deviation) and featurizing new data.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Creating a `NormalizingFeaturizer` using a custom featurization function and location data:</span>

<span class="sd">    ```</span>
<span class="sd">    import tensorflow as tf</span>
<span class="sd">    from geostat.model import NormalizingFeaturizer</span>

<span class="sd">    # Define a simple featurization function</span>
<span class="sd">    def custom_featurizer(x, y):</span>
<span class="sd">        return x, y, x * y</span>

<span class="sd">    # Sample location data</span>
<span class="sd">    locs = tf.constant([[1.0, 2.0], [3.0, 4.0], [5.0, 6.0]])</span>

<span class="sd">    # Create the NormalizingFeaturizer</span>
<span class="sd">    norm_featurizer = NormalizingFeaturizer(custom_featurizer, locs)</span>
<span class="sd">    ```</span>

<span class="sd">    Using the `NormalizingFeaturizer` to featurize new location data:</span>

<span class="sd">    ```</span>
<span class="sd">    new_locs = tf.constant([[7.0, 8.0], [9.0, 10.0]])</span>
<span class="sd">    F_matrix = norm_featurizer(new_locs)</span>
<span class="sd">    # F_matrix will contain normalized features with an additional intercept column</span>
<span class="sd">    ```</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The normalization parameters (`unnorm_mean` and `unnorm_std`) are calculated based on the </span>
<span class="sd">      initial `locs` data provided during initialization.</span>
<span class="sd">    - The `__call__` method applies the normalization and adds an intercept feature when used </span>
<span class="sd">      to featurize new location data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">featurization</span><span class="p">,</span> <span class="n">locs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unnorm_featurizer</span> <span class="o">=</span> <span class="n">Featurizer</span><span class="p">(</span><span class="n">featurization</span><span class="p">)</span>
        <span class="n">F_unnorm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnorm_featurizer</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unnorm_mean</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">F_unnorm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unnorm_std</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_std</span><span class="p">(</span><span class="n">F_unnorm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locs</span><span class="p">):</span>
        <span class="n">ones</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">locs</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">F_unnorm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnorm_featurizer</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span>
        <span class="n">F_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">F_unnorm</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnorm_mean</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnorm_std</span>
        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ones</span><span class="p">,</span> <span class="n">F_norm</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="src.geostat.model.Warp" class="doc doc-heading">
            <code>Warp</code>


</h3>


    <div class="doc doc-contents ">


              <details class="quote">
                <summary>Source code in <code>src/geostat/model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Warp</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locs</span><span class="p">,</span> <span class="n">prep</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `locs` is numpy.</span>

<span class="sd">        Returns a WarpLocations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">gather_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.geostat.model.Warp.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">locs</span><span class="p">,</span> <span class="n">prep</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p><code>locs</code> is numpy.</p>
<p>Returns a WarpLocations.</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locs</span><span class="p">,</span> <span class="n">prep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `locs` is numpy.</span>

<span class="sd">    Returns a WarpLocations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="src.geostat.model.gp_covariance2" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">gp_covariance2</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span> <span class="n">locs1</span><span class="p">,</span> <span class="n">cats1</span><span class="p">,</span> <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p><code>offset</code> is i2-i1, where i1 and i2 are the starting indices of locs1
and locs2.  It is used to create the diagonal non-zero elements
of a Noise covariance function.  An non-zero offset results in a
covariance matrix with non-zero entries along an off-center diagonal.</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tf</span><span class="o">.</span><span class="n">function</span>
<span class="k">def</span> <span class="nf">gp_covariance2</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span> <span class="n">locs1</span><span class="p">,</span> <span class="n">cats1</span><span class="p">,</span> <span class="n">locs2</span><span class="p">,</span> <span class="n">cats2</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `offset` is i2-i1, where i1 and i2 are the starting indices of locs1</span>
<span class="sd">    and locs2.  It is used to create the diagonal non-zero elements</span>
<span class="sd">    of a Noise covariance function.  An non-zero offset results in a</span>
<span class="sd">    covariance matrix with non-zero entries along an off-center diagonal.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># assert np.all(cats1 == np.sort(cats1)), &#39;`cats1` must be in non-descending order&#39;</span>
    <span class="c1"># assert np.all(cats2 == np.sort(cats2)), &#39;`cats2` must be in non-descending order&#39;</span>

    <span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offset</span>
    <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;locs1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">locs1</span>
    <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;locs2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">locs2</span>
    <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;cats1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cats1</span>
    <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;cats2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cats2</span>
    <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;per_axis_dist2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PerAxisDist2</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
    <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;euclidean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Euclidean</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>

    <span class="n">M</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">M</span><span class="p">,</span> <span class="n">C</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.geostat.model.interpolate_1d_tf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">interpolate_1d_tf</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p><code>src</code>: (batch, breaks)
<code>tgt</code>: (batch, breaks)
<code>x</code>  : (batch)</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tf</span><span class="o">.</span><span class="n">function</span>
<span class="k">def</span> <span class="nf">interpolate_1d_tf</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `src`: (batch, breaks)</span>
<span class="sd">    `tgt`: (batch, breaks)</span>
<span class="sd">    `x`  : (batch)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x_shape</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="c1"># (batch, 1)</span>
    <span class="n">bucket</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">bucket</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">clip_by_value</span><span class="p">(</span><span class="n">bucket</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">tgt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">src0</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">batch_dims</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">src1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">bucket</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">batch_dims</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">tgt0</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">tgt</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">batch_dims</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">tgt1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">tgt</span><span class="p">,</span> <span class="n">bucket</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">batch_dims</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">xout</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">src0</span><span class="p">)</span> <span class="o">*</span> <span class="n">tgt1</span> <span class="o">+</span> <span class="p">(</span><span class="n">src1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">tgt0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">src1</span> <span class="o">-</span> <span class="n">src0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xout</span><span class="p">,</span> <span class="n">x_shape</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.geostat.model.mvn_log_pdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mvn_log_pdf</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">cov</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Log PDF of a multivariate gaussian.</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">mvn_log_pdf</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">cov</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log PDF of a multivariate gaussian.&quot;&quot;&quot;</span>
    <span class="n">u_adj</span> <span class="o">=</span> <span class="n">u</span> <span class="o">-</span> <span class="n">m</span>
    <span class="n">logdet</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">logdet</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">cov</span><span class="p">)</span>
    <span class="n">quad</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">e</span><span class="p">(</span><span class="n">u_adj</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">cov</span><span class="p">,</span> <span class="n">e</span><span class="p">(</span><span class="n">u_adj</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)))[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">logdet</span> <span class="o">+</span> <span class="n">quad</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />


<div class="doc doc-object doc-module">



<h2 id="src.geostat.op" class="doc doc-heading">
            <code>src.geostat.op</code>


</h2>

    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="src.geostat.op.Op" class="doc doc-heading">
            <code>Op</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">


      <p>The <code>autoinputs</code> parameter contains a blob of upstream ops. The leaves
in the blob are either the op itself or a string identifier. In the
latter case, the string identifier should be present as a key in the
<code>cache</code> that gets passed in.</p>
<p>This parameter links ops together in a DAG. We walk the DAG for
various reasons.</p>
<ul>
<li><code>run</code> calls the op and puts the output in <code>self.out</code>,
    after recursively doing this for autoinputs.</li>
<li><code>gather_vars</code> recursively gathers variables from self and
    autoinputs.</li>
</ul>

              <details class="quote">
                <summary>Source code in <code>src/geostat/op.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Op</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The `autoinputs` parameter contains a blob of upstream ops. The leaves</span>
<span class="sd">    in the blob are either the op itself or a string identifier. In the</span>
<span class="sd">    latter case, the string identifier should be present as a key in the</span>
<span class="sd">    `cache` that gets passed in.</span>

<span class="sd">    This parameter links ops together in a DAG. We walk the DAG for</span>
<span class="sd">    various reasons.</span>

<span class="sd">      - `run` calls the op and puts the output in `self.out`,</span>
<span class="sd">        after recursively doing this for autoinputs.</span>
<span class="sd">      - `gather_vars` recursively gathers variables from self and</span>
<span class="sd">        autoinputs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fa</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span> <span class="c1"># Formal arguments.</span>
    <span class="n">autoinputs</span><span class="p">:</span> <span class="nb">object</span> <span class="c1"># Blob of Ops and strings.</span>

    <span class="k">def</span> <span class="nf">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># Parameters</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">gather_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `cache` maps from Op ids to sets of variable names.</span>

<span class="sd">        Returns a dict of parameters, keyed by name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="n">vv</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">autoinputs</span><span class="p">)</span>
                       <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">Op</span><span class="p">)</span>
                       <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">op</span><span class="o">.</span><span class="n">gather_vars</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="c1"># print(self, &#39;&lt;-&#39;, [x.name for x in vv], &#39;|&#39;, [x.name for x in set(self.vars())], &#39;\n&#39;)</span>
            <span class="n">cache</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">=</span> <span class="n">vv</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `e` is a dict of params and evaluated inputs from upstream ops.</span>
<span class="sd">        Other values in `e` are supplied by the caller.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If op has already been run, return result. Else:</span>
<span class="sd">            - Assemble inputs by recursively calling upstream ops.</span>
<span class="sd">            - Execute op by calling `__call__`.</span>
<span class="sd">            - Store result in cache.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="n">op</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Evaluate `op`. If `op` is a string, look up its value.</span>
<span class="sd">            Otherwise execute it.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">op</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">op</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">map_structure</span><span class="p">(</span><span class="k">lambda</span> <span class="n">op</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="n">op</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoinputs</span><span class="p">)</span>
            <span class="n">e</span> <span class="o">|=</span> <span class="n">get_parameter_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">)</span>
            <span class="n">cache</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

            <span class="c1"># Save the Op so that its ID remains unique.</span>
            <span class="k">if</span> <span class="s1">&#39;__save__&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span> <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;__save__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;__save__&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">__tf_tracing_type__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SingletonTraceType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.geostat.op.Op.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p><code>e</code> is a dict of params and evaluated inputs from upstream ops.
Other values in <code>e</code> are supplied by the caller.</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/op.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `e` is a dict of params and evaluated inputs from upstream ops.</span>
<span class="sd">    Other values in `e` are supplied by the caller.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.geostat.op.Op.gather_vars" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">gather_vars</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p><code>cache</code> maps from Op ids to sets of variable names.</p>
<p>Returns a dict of parameters, keyed by name.</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/op.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">gather_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `cache` maps from Op ids to sets of variable names.</span>

<span class="sd">    Returns a dict of parameters, keyed by name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
        <span class="n">vv</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">autoinputs</span><span class="p">)</span>
                   <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">Op</span><span class="p">)</span>
                   <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">op</span><span class="o">.</span><span class="n">gather_vars</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="c1"># print(self, &#39;&lt;-&#39;, [x.name for x in vv], &#39;|&#39;, [x.name for x in set(self.vars())], &#39;\n&#39;)</span>
        <span class="n">cache</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">=</span> <span class="n">vv</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.geostat.op.Op.run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>If op has already been run, return result. Else:
    - Assemble inputs by recursively calling upstream ops.
    - Execute op by calling <code>__call__</code>.
    - Store result in cache.</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/op.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If op has already been run, return result. Else:</span>
<span class="sd">        - Assemble inputs by recursively calling upstream ops.</span>
<span class="sd">        - Execute op by calling `__call__`.</span>
<span class="sd">        - Store result in cache.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="n">op</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate `op`. If `op` is a string, look up its value.</span>
<span class="sd">        Otherwise execute it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">op</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">op</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">map_structure</span><span class="p">(</span><span class="k">lambda</span> <span class="n">op</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="n">op</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoinputs</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">|=</span> <span class="n">get_parameter_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">)</span>
        <span class="n">cache</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="c1"># Save the Op so that its ID remains unique.</span>
        <span class="k">if</span> <span class="s1">&#39;__save__&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span> <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;__save__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;__save__&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="src.geostat.op.SingletonTraceType" class="doc doc-heading">
            <code>SingletonTraceType</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="tensorflow.types.experimental.TraceType">TraceType</span></code></p>


      <p>A trace type to override TF's default behavior, which is
to treat dataclass-based onjects as dicts.</p>

              <details class="quote">
                <summary>Source code in <code>src/geostat/op.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SingletonTraceType</span><span class="p">(</span><span class="n">TraceType</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A trace type to override TF&#39;s default behavior, which is</span>
<span class="sd">    to treat dataclass-based onjects as dicts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">thing</span>

    <span class="k">def</span> <span class="nf">is_subtype_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">most_specific_common_supertype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">placeholder_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">placeholder_context</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div><hr />


<div class="doc doc-object doc-module">



<h2 id="src.geostat.param" class="doc doc-heading">
            <code>src.geostat.param</code>


</h2>

    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="src.geostat.param.Parameter" class="doc doc-heading">
            <code>Parameter</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">


              <details class="quote">
                <summary>Source code in <code>src/geostat/param.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Parameter</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">lo</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">hi</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">underlying</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">update_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lo</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">hi</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lo</span> <span class="o">=</span> <span class="n">lo</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="n">lo</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Conflicting bounds for parameter </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hi</span> <span class="o">=</span> <span class="n">hi</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span> <span class="o">==</span> <span class="n">hi</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Conflicting bounds for parameter </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">bounding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> \
            <span class="p">(</span><span class="s1">&#39;u&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(</span><span class="s1">&#39;u&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_tf_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create TF variable for underlying parameter or update it&quot;&quot;&quot;</span>
        <span class="c1"># Create underlying parameter.</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounding</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="s1">&#39;bb&#39;</span><span class="p">:</span>
            <span class="n">init</span> <span class="o">=</span> <span class="n">logit</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">b</span> <span class="o">==</span> <span class="s1">&#39;bu&#39;</span><span class="p">:</span>
            <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">b</span> <span class="o">==</span> <span class="s1">&#39;ub&#39;</span><span class="p">:</span>
            <span class="n">init</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">underlying</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">underlying</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">underlying</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">surface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create tensor for surface parameter&quot;&quot;&quot;</span>
        <span class="c1"># Create surface parameter.</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounding</span><span class="p">()</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">underlying</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="s1">&#39;bb&#39;</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span>
        <span class="k">elif</span> <span class="n">b</span> <span class="o">==</span> <span class="s1">&#39;bu&#39;</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span>
        <span class="k">elif</span> <span class="n">b</span> <span class="o">==</span> <span class="s1">&#39;ub&#39;</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">update_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.geostat.param.Parameter.create_tf_variable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_tf_variable</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Create TF variable for underlying parameter or update it</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/param.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_tf_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create TF variable for underlying parameter or update it&quot;&quot;&quot;</span>
    <span class="c1"># Create underlying parameter.</span>
    <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounding</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="s1">&#39;bb&#39;</span><span class="p">:</span>
        <span class="n">init</span> <span class="o">=</span> <span class="n">logit</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">b</span> <span class="o">==</span> <span class="s1">&#39;bu&#39;</span><span class="p">:</span>
        <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">b</span> <span class="o">==</span> <span class="s1">&#39;ub&#39;</span><span class="p">:</span>
        <span class="n">init</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">underlying</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">underlying</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">underlying</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.geostat.param.Parameter.surface" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">surface</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

      <p>Create tensor for surface parameter</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/param.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">surface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create tensor for surface parameter&quot;&quot;&quot;</span>
    <span class="c1"># Create surface parameter.</span>
    <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounding</span><span class="p">()</span>
    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">underlying</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="s1">&#39;bb&#39;</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hi</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span>
    <span class="k">elif</span> <span class="n">b</span> <span class="o">==</span> <span class="s1">&#39;bu&#39;</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo</span>
    <span class="k">elif</span> <span class="n">b</span> <span class="o">==</span> <span class="s1">&#39;ub&#39;</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">v</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="src.geostat.param.bpp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bpp</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Bounded paper parameter (maybe).</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/param.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bpp</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Bounded paper parameter (maybe).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
        <span class="n">param</span><span class="o">.</span><span class="n">update_bounds</span><span class="p">(</span><span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">param</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.geostat.param.get_parameter_values" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_parameter_values</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>For each Parameter encountered in the nested blob,
replace it with its surface tensor.</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/param.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_parameter_values</span><span class="p">(</span><span class="n">blob</span><span class="p">:</span> <span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For each Parameter encountered in the nested blob,</span>
<span class="sd">    replace it with its surface tensor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">blob</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">get_parameter_values</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">blob</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">blob</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">get_parameter_values</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">blob</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">blob</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">blob</span><span class="o">.</span><span class="n">surface</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">blob</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Bad parameter </span><span class="si">{</span><span class="n">blob</span><span class="si">}</span><span class="s1"> is a string&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">blob</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.geostat.param.ppp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ppp</span><span class="p">(</span><span class="n">param</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Positive paper parameter (maybe).</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/param.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ppp</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Positive paper parameter (maybe).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
        <span class="n">param</span><span class="o">.</span><span class="n">update_bounds</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">param</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.geostat.param.upp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upp</span><span class="p">(</span><span class="n">param</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Unbounded paper parameter (maybe).</p>

            <details class="quote">
              <summary>Source code in <code>src/geostat/param.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">upp</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unbounded paper parameter (maybe).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>
        <span class="n">param</span><span class="o">.</span><span class="n">update_bounds</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">param</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.56dfad97.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>